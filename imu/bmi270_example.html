<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BMI270 Example - ESP32 -  &mdash; ESPP main documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=a60756f2" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=949a1ff5" />
      <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css?v=851bd809" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=d01aebe5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=ff8fa330"></script>
    <script src="../_static/js/theme.js"></script>

    
        

    <script type="text/javascript">
        DOCUMENTATION_OPTIONS.PAGENAME = 'imu/bmi270_example';
        DOCUMENTATION_OPTIONS.PROJECT_SLUG = 'esp-cpp';
        DOCUMENTATION_OPTIONS.LATEST_BRANCH_NAME = 'master';
        DOCUMENTATION_OPTIONS.VERSIONS_URL = 'https://dl.espressif.com/dl/esp-idf/idf_versions.js';
        DOCUMENTATION_OPTIONS.LANGUAGES = ["en"];
        DOCUMENTATION_OPTIONS.IDF_TARGET = 'esp32';
        DOCUMENTATION_OPTIONS.HAS_IDF_TARGETS = ["esp32", "esp32s2", "esp32c3"]
        DOCUMENTATION_OPTIONS.RELEASE = 'main';
        DOCUMENTATION_OPTIONS.LANGUAGE_URL = 'en';

    </script>

    <script type="text/javascript" src="https://dl.espressif.com/dl/esp-idf/idf_versions.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ICM20948 9-Axis IMU" href="icm20948.html" />
    <link rel="prev" title="BMI270 6-Axis IMU" href="bmi270.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            ESPP
              <img src="../_static/espressif-logo.svg" class="logo" alt="Logo"/>
          </a>

          
            <div class="selectors">
              <select id="target-select" style="width: 150px;" hidden>
                <option value="" disabled selected>Choose target...</option>
              </select>
            </div>
          

          <div class="selectors">
            <select id="version-select" style="width: 150px;" hidden>
              <option value="" disabled selected>Choose version...</option>
            </select>
          </div>

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../adc/index.html">ADC APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../base_component.html">Base Component</a></li>
<li class="toctree-l1"><a class="reference internal" href="../base_peripheral.html">Base Peripheral</a></li>
<li class="toctree-l1"><a class="reference internal" href="../battery/index.html">Battery APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bldc/index.html">BLDC APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble/index.html">BLE APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../button.html">Button APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../byte90.html">ALXV Labs Byte90</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controller.html">Controller APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">Command Line Interface (CLI) APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cobs.html">COBS (Consistent Overhead Byte Stuffing)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../color.html">Color APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../csv.html">CSV APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../display/index.html">Display APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distance_sensors/index.html">Distance Sensor APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../encoder/index.html">Encoder APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../esp32_timer_cam.html">ESP32 TimerCam</a></li>
<li class="toctree-l1"><a class="reference internal" href="../esp_box.html">ESP BOX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../event_manager.html">Event Manager APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../file_system.html">File System APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filters/index.html">Filter APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ftp/index.html">FTP APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../haptics/index.html">Haptics APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hid/index.html">HID APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i2c.html">I2C</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">IMU APIs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="adxl345.html">ADXL345 3-Axis Accelerometer</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="bmi270.html">BMI270 6-Axis IMU</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">BMI270 Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#features-demonstrated">Features Demonstrated</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-to-use-example">How to use example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-output">Example Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#performance-notes">Performance Notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#advanced-features">Advanced Features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="bmi270.html#api-reference">API Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="icm20948.html">ICM20948 9-Axis IMU</a></li>
<li class="toctree-l2"><a class="reference internal" href="icm42607.html">ICM42607 6-Axis IMU</a></li>
<li class="toctree-l2"><a class="reference internal" href="lsm6dso.html">LSM6DSO 6-Axis IMU</a></li>
<li class="toctree-l2"><a class="reference internal" href="qmi8658.html">QMI8658 6-Axis IMU</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../interrupt.html">Interrupt APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">Input APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../io_expander/index.html">IO Expander APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iperf_menu.html">Iperf Menu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../joystick.html">Joystick APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../led.html">LED APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../led_driver/index.html">LED Driver Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../led_strip.html">LED Strip APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logger.html">Logging APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m5stack_tab5.html">M5Stack Tab5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../math/index.html">Math APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../matouch_rotary_display.html">MaTouch Rotary Display</a></li>
<li class="toctree-l1"><a class="reference internal" href="../monitor.html">Monitoring APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../motorgo_mini.html">MotorGo Mini</a></li>
<li class="toctree-l1"><a class="reference internal" href="../neopixel.html">Neopixel APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/index.html">Network APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nfc/index.html">NFC APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nvs.html">NVS APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../odrive_ascii.html">ODrive ASCII Protocol Component</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pid.html">PID APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power/index.html">Power Monitoring APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qtpy.html">QtPy ESP32 Pico and QtPy ESP32-S3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qwiicnes.html">QwiicNES</a></li>
<li class="toctree-l1"><a class="reference internal" href="../remote_debug.html">Remote Debug APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rmt.html">Remote Control Transceiver (RMT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rtc/index.html">RTC APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rtsp.html">RTSP APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../runqueue.html">RunQueue APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../seeed_studio_round_display.html">Seeed Studio Round Display</a></li>
<li class="toctree-l1"><a class="reference internal" href="../serialization.html">Serialization APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../state_machine.html">State Machine APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../t_deck.html">LilyGo T-Deck</a></li>
<li class="toctree-l1"><a class="reference internal" href="../t_dongle_s3.html">LilyGo T-Dongle S3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tabulate.html">Tabulate APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../task.html">Task APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thermistor.html">Thermistor APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timer.html">Timer APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wifi/index.html">WiFi APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wrover_kit.html">ESP32-WROVER-KIT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ws_s3_geek.html">Waveshare ESP32-S3 GEEK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ws_s3_lcd_1_47.html">Waveshare ESP32-S3 LCD 1.47”</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ws_s3_touch.html">Waveshare ESP32-S3 TouchLCD</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ESPP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">IMU APIs</a></li>
          <li class="breadcrumb-item"><a href="bmi270.html">BMI270 6-Axis IMU</a></li>
      <li class="breadcrumb-item active">BMI270 Example</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/esp-cpp/espp/blob/32e8215e/docs/en/imu/bmi270_example.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="bmi270-example">
<h1>BMI270 Example<a class="headerlink" href="#bmi270-example" title="Permalink to this heading"></a></h1>
<p>This example shows how to use the <code class="docutils literal notranslate"><span class="pre">espp::Bmi270</span></code> component to initialize and communicate with a BMI270 6-axis IMU.</p>
<img width="822" height="930" alt="CleanShot 2025-08-09 at 17 22 30" src="https://github.com/user-attachments/assets/5ea18011-592d-4fa6-bdde-3a7afb84396b" />
<!-- markdown-toc start - Don't edit this section. Run M-x markdown-toc-refresh-toc -->
<p><strong>Table of Contents</strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="#bmi270-example"><span class="xref myst">BMI270 Example</span></a></p>
<ul>
<li><p><a class="reference internal" href="#features-demonstrated"><span class="xref myst">Features Demonstrated</span></a></p></li>
<li><p><a class="reference internal" href="#how-to-use-example"><span class="xref myst">How to use example</span></a></p>
<ul>
<li><p><a class="reference internal" href="#hardware-required"><span class="xref myst">Hardware Required</span></a></p></li>
<li><p><a class="reference internal" href="#configuration"><span class="xref myst">Configuration</span></a></p></li>
<li><p><a class="reference internal" href="#build-and-flash"><span class="xref myst">Build and Flash</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#example-output"><span class="xref myst">Example Output</span></a></p>
<ul>
<li><p><a class="reference internal" href="#sample-output"><span class="xref myst">Sample Output</span></a></p></li>
<li><p><a class="reference internal" href="#data-analysis"><span class="xref myst">Data Analysis</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#troubleshooting"><span class="xref myst">Troubleshooting</span></a></p>
<ul>
<li><p><a class="reference internal" href="#common-issues"><span class="xref myst">Common Issues</span></a></p></li>
<li><p><a class="reference internal" href="#debug-tips"><span class="xref myst">Debug Tips</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#performance-notes"><span class="xref myst">Performance Notes</span></a></p></li>
<li><p><a class="reference internal" href="#advanced-features"><span class="xref myst">Advanced Features</span></a></p>
<ul>
<li><p><a class="reference internal" href="#data-ready-interrupt"><span class="xref myst">Data Ready Interrupt</span></a></p></li>
<li><p><a class="reference internal" href="#fast-offset-compensation-foc"><span class="xref myst">Fast Offset Compensation (FOC)</span></a></p></li>
<li><p><a class="reference internal" href="#component-re-trim-crt"><span class="xref myst">Component Re-Trim (CRT)</span></a></p></li>
<li><p><a class="reference internal" href="#built-in-features"><span class="xref myst">Built-in Features</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#references"><span class="xref myst">References</span></a></p></li>
</ul>
</li>
</ul>
<!-- markdown-toc end -->
<section id="features-demonstrated">
<h2>Features Demonstrated<a class="headerlink" href="#features-demonstrated" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><strong>Basic IMU Reading</strong>: Accelerometer, gyroscope, and temperature data</p></li>
<li><p><strong>Orientation Filtering</strong>: Both Kalman and Madgwick filter implementations</p></li>
<li><p><strong>Real-time Data Logging</strong>: CSV format output suitable for plotting</p></li>
<li><p><strong>Interrupt Configuration</strong>: Data ready and motion detection interrupts</p></li>
<li><p><strong>Fast Offset Compensation (FOC)</strong>: Calibrate accelerometer and gyroscope offsets</p></li>
<li><p><strong>Component Re-Trim (CRT)</strong>: Compensate for gyroscope sensitivity changes</p></li>
<li><p><strong>Advanced Configuration</strong>: Performance modes, bandwidth settings, power management</p></li>
</ul>
</section>
<section id="how-to-use-example">
<h2>How to use example<a class="headerlink" href="#how-to-use-example" title="Permalink to this heading"></a></h2>
<section id="hardware-required">
<h3>Hardware Required<a class="headerlink" href="#hardware-required" title="Permalink to this heading"></a></h3>
<p>This example can run on any ESP32 development board with I2C pins available. Connect a BMI270 sensor as follows:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>BMI270 Pin</p></th>
<th class="head"><p>ESP32 Pin</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>VDD</p></td>
<td><p>3.3V</p></td>
<td><p>Power supply</p></td>
</tr>
<tr class="row-odd"><td><p>VDDIO</p></td>
<td><p>3.3V</p></td>
<td><p>I/O power supply</p></td>
</tr>
<tr class="row-even"><td><p>GND</p></td>
<td><p>GND</p></td>
<td><p>Ground</p></td>
</tr>
<tr class="row-odd"><td><p>SCL</p></td>
<td><p>GPIO22</p></td>
<td><p>I2C clock (configurable)</p></td>
</tr>
<tr class="row-even"><td><p>SDA</p></td>
<td><p>GPIO21</p></td>
<td><p>I2C data (configurable)</p></td>
</tr>
<tr class="row-odd"><td><p>SDO</p></td>
<td><p>GND</p></td>
<td><p>I2C address select (0x68)</p></td>
</tr>
<tr class="row-even"><td><p>INT1</p></td>
<td><p>GPIO (optional)</p></td>
<td><p>Interrupt 1 output</p></td>
</tr>
</tbody>
</table>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h3>
<p>You can configure the I2C pins through menuconfig:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">idf</span><span class="o">.</span><span class="n">py</span> <span class="n">menuconfig</span>
</pre></div>
</div>
<p>Navigate to: <code class="docutils literal notranslate"><span class="pre">BMI270</span> <span class="pre">Example</span> <span class="pre">Configuration</span></code></p>
<ul class="simple">
<li><p><strong>SCL GPIO Num</strong>: I2C clock pin (default: 22). If running on M5Stack Tab5, set to 32.</p></li>
<li><p><strong>SDA GPIO Num</strong>: I2C data pin (default: 21). If running on M5Stack Tab5, set to 31.</p></li>
<li><p><strong>I2C Clock Speed</strong>: I2C frequency in Hz (default: 1000000)</p></li>
</ul>
</section>
<section id="build-and-flash">
<h3>Build and Flash<a class="headerlink" href="#build-and-flash" title="Permalink to this heading"></a></h3>
<p>Build the project and flash it to the board, then run monitor tool to view serial output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">idf</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">p</span> <span class="n">PORT</span> <span class="n">flash</span> <span class="n">monitor</span>
</pre></div>
</div>
<p>(Replace PORT with the name of the serial port to use.)</p>
<p>(To exit the serial monitor, type <code class="docutils literal notranslate"><span class="pre">Ctrl-]</span></code>.)</p>
<p>See the Getting Started Guide for full steps to configure and use ESP-IDF to build projects.</p>
</section>
</section>
<section id="example-output">
<h2>Example Output<a class="headerlink" href="#example-output" title="Permalink to this heading"></a></h2>
<p>The example outputs CSV-formatted data that includes:</p>
<ol class="arabic simple">
<li><p><strong>Timestamp</strong> (seconds)</p></li>
<li><p><strong>Raw accelerometer data</strong> (g)</p></li>
<li><p><strong>Raw gyroscope data</strong> (°/s)</p></li>
<li><p><strong>Temperature</strong> (°C)</p></li>
<li><p><strong>Kalman filter orientation</strong> (radians)</p></li>
<li><p><strong>Kalman filter gravity vector</strong></p></li>
<li><p><strong>Madgwick filter orientation</strong> (radians)</p></li>
<li><p><strong>Madgwick filter gravity vector</strong></p></li>
</ol>
<section id="sample-output">
<h3>Sample Output<a class="headerlink" href="#sample-output" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>I (298) main_task: Calling app_main()
[BMI270 Example/I][0.023]: Starting example!
[BMI270 Example/I][0.028]: Found BMI270 at address: 0x68
[Bmi270/I][0.036]: Setting power mode to 4
[Bmi270/I][0.039]: Loading BMI270 configuration file (8192 B), this may take some time...
[Bmi270/I][0.140]: Configuration file loaded successfully
[Bmi270/I][0.141]: BMI270 initialized successfully
% Time (s), Accel X (g), Accel Y (g), Accel Z (g), Gyro X (°/s), Gyro Y (°/s), Gyro Z (°/s), Temp (°C), Kalman Roll (rad), Kalman Pitch (rad), Kalman Yaw (rad), Kalman Gravity X, Kalman Gravity Y, Kalman Gravity Z, Madgwick Roll (rad), Madgwick Pitch (rad), Madgwick Yaw (rad), Madgwick Gravity X, Madgwick Gravity Y, Madgwick Gravity Z
[BMI270 Example/I][0.170]: Starting task...
0.186,-0.005,-0.052,0.993,0.000,0.000,0.000,27.3,-0.052,0.006,0.000,0.006,0.052,-0.999,0.000,-0.000,0.000,-0.000,-0.000,-1.000
0.198,-0.005,-0.051,1.002,-0.213,-0.427,-0.335,27.4,-0.050,0.005,0.000,0.005,0.050,-0.999,-0.002,0.000,-0.000,0.000,0.002,-1.000
0.210,-0.004,-0.051,1.000,0.244,-0.579,-0.915,27.3,-0.051,0.004,0.000,0.004,0.051,-0.999,-0.005,0.000,-0.000,0.000,0.005,-1.000
0.222,-0.004,-0.052,0.998,0.030,-0.122,-0.274,27.3,-0.052,0.004,0.000,0.004,0.052,-0.999,-0.007,0.000,-0.000,0.000,0.007,-1.000
0.234,-0.005,-0.051,0.999,0.000,-0.213,-0.213,27.3,-0.051,0.005,0.000,0.005,0.051,-0.999,-0.010,0.001,-0.000,0.001,0.010,-1.000
0.246,-0.004,-0.051,0.998,0.030,-0.152,-0.183,27.4,-0.051,0.004,0.000,0.004,0.051,-0.999,-0.012,0.001,-0.000,0.001,0.012,-1.000
0.258,-0.005,-0.051,0.999,0.061,-0.183,-0.183,27.4,-0.051,0.005,0.000,0.005,0.051,-0.999,-0.014,0.001,-0.000,0.001,0.014,-1.000
0.270,-0.003,-0.051,1.000,0.061,-0.183,-0.183,27.4,-0.051,0.003,0.000,0.003,0.051,-0.999,-0.017,0.001,-0.000,0.001,0.017,-1.000
0.282,-0.005,-0.051,1.000,0.030,-0.183,-0.213,27.4,-0.051,0.005,0.000,0.005,0.051,-0.999,-0.019,0.001,-0.001,0.001,0.019,-1.000
0.294,-0.003,-0.049,0.999,0.091,-0.183,-0.213,27.3,-0.049,0.003,0.000,0.003,0.049,-0.999,-0.021,0.001,-0.001,0.001,0.021,-1.000
0.306,-0.004,-0.049,0.999,0.061,-0.091,-0.274,27.4,-0.049,0.004,0.000,0.004,0.049,-0.999,-0.024,0.002,-0.001,0.002,0.024,-1.000
0.318,-0.005,-0.050,0.999,0.061,-0.213,-0.213,27.4,-0.050,0.005,0.000,0.005,0.050,-0.999,-0.026,0.002,-0.001,0.002,0.026,-1.000
0.330,-0.007,-0.052,0.999,0.091,-0.183,-0.244,27.4,-0.052,0.007,0.000,0.007,0.052,-0.999,-0.029,0.002,-0.001,0.002,0.029,-1.000
0.342,-0.006,-0.052,1.000,0.152,-0.152,-0.274,27.4,-0.052,0.006,0.000,0.006,0.052,-0.999,-0.031,0.003,-0.001,0.003,0.031,-1.000
0.354,-0.004,-0.051,1.002,0.061,-0.183,-0.244,27.4,-0.051,0.004,0.000,0.004,0.051,-0.999,-0.033,0.003,-0.001,0.003,0.033,-0.999
0.366,-0.004,-0.052,1.000,0.061,-0.244,-0.213,27.4,-0.052,0.004,0.000,0.004,0.052,-0.999,-0.036,0.003,-0.001,0.003,0.036,-0.999
0.378,-0.004,-0.052,1.001,0.061,-0.183,-0.183,27.4,-0.051,0.004,0.000,0.004,0.051,-0.999,-0.038,0.003,-0.001,0.003,0.038,-0.999
0.390,-0.003,-0.049,1.000,0.030,-0.152,-0.183,27.4,-0.049,0.003,0.000,0.003,0.049,-0.999,-0.040,0.003,-0.001,0.003,0.040,-0.999
0.402,-0.004,-0.051,0.999,0.061,-0.152,-0.213,27.4,-0.051,0.004,0.000,0.004,0.051,-0.999,-0.043,0.003,-0.001,0.003,0.043,-0.999
0.414,-0.004,-0.051,1.000,0.152,-0.244,-0.305,27.4,-0.051,0.004,0.000,0.004,0.051,-0.999,-0.045,0.003,-0.001,0.003,0.045,-0.999
0.426,-0.004,-0.052,1.000,0.030,-0.152,-0.183,27.4,-0.052,0.004,0.000,0.004,0.052,-0.999,-0.048,0.004,-0.001,0.004,0.047,-0.999
0.438,-0.005,-0.051,1.000,0.061,-0.152,-0.244,27.4,-0.051,0.005,0.000,0.005,0.051,-0.999,-0.050,0.005,-0.001,0.005,0.050,-0.999
0.450,-0.005,-0.050,0.999,0.030,-0.122,-0.274,27.4,-0.050,0.005,0.000,0.005,0.050,-0.999,-0.052,0.006,-0.001,0.006,0.052,-0.999
0.462,-0.004,-0.050,1.000,0.000,-0.183,-0.213,27.4,-0.050,0.004,0.000,0.004,0.050,-0.999,-0.050,0.004,-0.001,0.004,0.050,-0.999
0.474,-0.005,-0.051,0.999,0.091,-0.244,-0.274,27.4,-0.051,0.005,0.000,0.005,0.051,-0.999,-0.052,0.005,-0.001,0.005,0.052,-0.999
0.486,-0.004,-0.051,1.000,0.061,-0.183,-0.244,27.4,-0.051,0.004,0.000,0.004,0.051,-0.999,-0.051,0.003,-0.001,0.003,0.051,-0.999
0.498,-0.004,-0.052,1.000,0.152,-0.274,-0.274,27.4,-0.051,0.004,0.000,0.004,0.051,-0.999,-0.052,0.005,-0.001,0.005,0.052,-0.999
0.510,-0.006,-0.053,1.000,0.152,-0.122,-0.244,27.4,-0.053,0.006,0.000,0.006,0.053,-0.999,-0.054,0.006,-0.002,0.006,0.054,-0.999
0.522,-0.005,-0.052,1.000,0.030,-0.183,-0.244,27.4,-0.052,0.005,0.000,0.005,0.051,-0.999,-0.052,0.005,-0.002,0.005,0.052,-0.999
0.534,-0.003,-0.052,1.000,0.030,-0.152,-0.274,27.4,-0.052,0.003,0.000,0.003,0.052,-0.999,-0.053,0.003,-0.002,0.003,0.053,-0.999
0.546,-0.003,-0.051,0.999,0.061,-0.152,-0.335,27.4,-0.051,0.003,0.000,0.003,0.051,-0.999,-0.051,0.004,-0.002,0.004,0.051,-0.999
0.558,-0.006,-0.052,1.000,0.061,-0.122,-0.335,27.4,-0.052,0.006,0.000,0.006,0.052,-0.999,-0.052,0.006,-0.002,0.006,0.052,-0.999
0.570,-0.005,-0.051,1.001,0.030,-0.152,-0.274,27.4,-0.051,0.005,0.000,0.005,0.051,-0.999,-0.050,0.004,-0.002,0.004,0.050,-0.999
0.582,-0.004,-0.050,1.001,0.061,-0.183,-0.274,27.4,-0.050,0.004,0.000,0.004,0.050,-0.999,-0.051,0.006,-0.002,0.006,0.051,-0.999
0.594,-0.004,-0.050,1.001,0.061,-0.244,-0.183,27.4,-0.050,0.004,0.000,0.004,0.050,-0.999,-0.050,0.004,-0.002,0.004,0.050,-0.999
0.606,-0.005,-0.052,0.999,0.091,-0.213,-0.244,27.4,-0.051,0.005,0.000,0.005,0.051,-0.999,-0.052,0.005,-0.002,0.005,0.052,-0.999
0.618,-0.004,-0.052,1.000,0.091,-0.152,-0.152,27.4,-0.052,0.004,0.000,0.004,0.052,-0.999,-0.051,0.003,-0.002,0.003,0.051,-0.999
0.630,-0.005,-0.051,1.002,0.091,-0.274,-0.152,27.4,-0.051,0.005,0.000,0.005,0.051,-0.999,-0.051,0.005,-0.002,0.005,0.051,-0.999
0.642,-0.005,-0.052,1.001,0.000,-0.213,-0.244,27.4,-0.051,0.005,0.000,0.005,0.051,-0.999,-0.053,0.003,-0.002,0.003,0.053,-0.999
0.654,-0.004,-0.052,1.001,0.030,-0.213,-0.305,27.4,-0.052,0.004,0.000,0.004,0.052,-0.999,-0.051,0.004,-0.002,0.004,0.051,-0.999
0.666,-0.004,-0.051,1.001,0.000,-0.152,-0.244,27.4,-0.051,0.004,0.000,0.004,0.051,-0.999,-0.049,0.004,-0.002,0.004,0.049,-0.999
0.678,-0.006,-0.051,1.000,0.152,-0.183,-0.274,27.4,-0.051,0.006,0.000,0.006,0.051,-0.999,-0.051,0.006,-0.002,0.006,0.051,-0.999
</pre></div>
</div>
<img width="1905" height="902" alt="CleanShot 2025-08-09 at 17 06 50" src="https://github.com/user-attachments/assets/7784a5ee-41e3-466e-8b62-882f5be4ab5d" />
<img width="822" height="930" alt="CleanShot 2025-08-09 at 17 22 30" src="https://github.com/user-attachments/assets/5ea18011-592d-4fa6-bdde-3a7afb84396b" />
<img width="822" height="930" alt="CleanShot 2025-08-09 at 17 22 47" src="https://github.com/user-attachments/assets/358c05da-4dea-465c-8dc6-6ec3b9ca7cae" />
</section>
<section id="data-analysis">
<h3>Data Analysis<a class="headerlink" href="#data-analysis" title="Permalink to this heading"></a></h3>
<p>The CSV output can be imported into analysis tools like:</p>
<ul class="simple">
<li><p><strong>MATLAB/Octave</strong>: For advanced signal processing</p></li>
<li><p><strong>Python (pandas/matplotlib)</strong>: For data visualization</p></li>
<li><p><strong>Excel/LibreOffice</strong>: For basic analysis</p></li>
<li><p><strong><a class="reference external" href="https://github.com/esp-cpp/uart_serial_plotter">esp-cpp/uart-serial-plotter</a></strong>: For real-time plotting</p></li>
</ul>
</section>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this heading"></a></h2>
<section id="common-issues">
<h3>Common Issues<a class="headerlink" href="#common-issues" title="Permalink to this heading"></a></h3>
<p><strong>No device found (Device ID read fails):</strong></p>
<ul class="simple">
<li><p>Check I2C wiring (SDA, SCL, power, ground)</p></li>
<li><p>Verify power supply voltage (3.3V)</p></li>
</ul>
<p><strong>Noisy data:</strong></p>
<ul class="simple">
<li><p>Check power supply stability</p></li>
<li><p>Add decoupling capacitors (100nF ceramic + 10µF electrolytic)</p></li>
<li><p>Ensure stable mechanical mounting</p></li>
<li><p>Consider using performance mode for gyroscope</p></li>
<li><p>Adjust filter bandwidth settings</p></li>
</ul>
<p><strong>No data updates:</strong></p>
<ul class="simple">
<li><p>Check if <code class="docutils literal notranslate"><span class="pre">has_new_data()</span></code> returns true</p></li>
<li><p>Verify ODR (Output Data Rate) settings</p></li>
<li><p>Check interrupt configuration if using interrupt mode</p></li>
<li><p>Ensure proper timing in update loop</p></li>
</ul>
<p><strong>Orientation drift:</strong></p>
<ul class="simple">
<li><p>Calibrate gyroscope offset</p></li>
<li><p>Tune filter parameters (process/measurement noise)</p></li>
<li><p>Consider magnetometer integration for yaw correction</p></li>
<li><p>Check for temperature effects</p></li>
</ul>
<p><strong>Stack Overflow during Initialization</strong>:</p>
<ul>
<li><p>Device crashes or resets while calling <code class="docutils literal notranslate"><span class="pre">bmi270.init()</span></code>.</p></li>
<li><p>Uploading the configuration file uses a large stack buffer by default.</p></li>
<li><p>Reduce the burst write size in the configuration to limit stack usage.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">espp</span><span class="o">::</span><span class="n">Bmi270</span><span class="o">::</span><span class="n">Config</span><span class="w"> </span><span class="n">config</span><span class="p">;</span>
<span class="n">config</span><span class="p">.</span><span class="n">burst_write_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">128</span><span class="p">;</span><span class="w"> </span><span class="c1">// Use 128-byte chunks (default 0 = one chunk of config_file_size bytes, e.g. 8192)</span>
<span class="n">espp</span><span class="o">::</span><span class="n">Bmi270</span><span class="w"> </span><span class="nf">imu</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="debug-tips">
<h3>Debug Tips<a class="headerlink" href="#debug-tips" title="Permalink to this heading"></a></h3>
<ol class="arabic">
<li><p><strong>Enable verbose logging:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">config</span><span class="p">.</span><span class="n">log_level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">espp</span><span class="o">::</span><span class="n">Logger</span><span class="o">::</span><span class="n">Verbosity</span><span class="o">::</span><span class="n">DEBUG</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p><strong>Check register values:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imu</span><span class="p">.</span><span class="n">read_u8_from_register</span><span class="p">(</span><span class="mh">0x03</span><span class="p">,</span><span class="w"> </span><span class="n">ec</span><span class="p">);</span><span class="w">  </span><span class="c1">// STATUS register</span>
<span class="n">fmt</span><span class="o">::</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Status: 0x{:02X}</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p><strong>Monitor timing:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_timer_get_time</span><span class="p">();</span>
<span class="n">imu</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="w"> </span><span class="n">ec</span><span class="p">);</span>
<span class="k">auto</span><span class="w"> </span><span class="n">elapsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_timer_get_time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">;</span>
<span class="n">fmt</span><span class="o">::</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Update time: {} µs</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">elapsed</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="performance-notes">
<h2>Performance Notes<a class="headerlink" href="#performance-notes" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><strong>Update Rate</strong>: Up to 100Hz in this example (configurable)</p></li>
<li><p><strong>Latency</strong>: &lt; 1ms for basic IMU reading</p></li>
<li><p><strong>Memory Usage</strong>: ~6KB stack for IMU task</p></li>
<li><p><strong>CPU Usage</strong>: &lt; 5% at 100Hz update rate on ESP32-S3</p></li>
<li><p><strong>Power Consumption</strong>: ~685µA for BMI270 in normal mode</p></li>
</ul>
</section>
<section id="advanced-features">
<h2>Advanced Features<a class="headerlink" href="#advanced-features" title="Permalink to this heading"></a></h2>
<section id="data-ready-interrupt">
<h3>Data Ready Interrupt<a class="headerlink" href="#data-ready-interrupt" title="Permalink to this heading"></a></h3>
<p>The BMI270 can be configured to generate an interrupt when new data is available. This is more efficient than polling the sensor.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">error_code</span><span class="w"> </span><span class="n">ec</span><span class="p">;</span>

<span class="n">Imu</span><span class="o">::</span><span class="n">InterruptConfig</span><span class="w"> </span><span class="n">int_config</span><span class="p">{</span>
<span class="w">    </span><span class="p">.</span><span class="n">pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Imu</span><span class="o">::</span><span class="n">InterruptPin</span><span class="o">::</span><span class="n">INT1</span><span class="p">,</span>
<span class="w">    </span><span class="p">.</span><span class="n">output_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Imu</span><span class="o">::</span><span class="n">InterruptOutput</span><span class="o">::</span><span class="n">PUSH_PULL</span><span class="p">,</span>
<span class="w">    </span><span class="p">.</span><span class="n">active_level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Imu</span><span class="o">::</span><span class="n">InterruptLevel</span><span class="o">::</span><span class="n">ACTIVE_HIGH</span><span class="p">,</span>
<span class="w">    </span><span class="p">.</span><span class="n">enable_data_ready</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
<span class="p">};</span>
<span class="n">imu</span><span class="p">.</span><span class="n">configure_interrupts</span><span class="p">(</span><span class="n">int_config</span><span class="p">,</span><span class="w"> </span><span class="n">ec</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="fast-offset-compensation-foc">
<h3>Fast Offset Compensation (FOC)<a class="headerlink" href="#fast-offset-compensation-foc" title="Permalink to this heading"></a></h3>
<p>FOC allows for quick calibration of the accelerometer and gyroscope offsets.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Accelerometer FOC (e.g., device flat on table, Z axis pointing up)</span>
<span class="n">Imu</span><span class="o">::</span><span class="n">AccelFocGValue</span><span class="w"> </span><span class="n">accel_foc_target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">sign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="c1">// 1g on Z axis</span>
<span class="p">};</span>
<span class="n">imu</span><span class="p">.</span><span class="n">perform_accel_foc</span><span class="p">(</span><span class="n">accel_foc_target</span><span class="p">,</span><span class="w"> </span><span class="n">ec</span><span class="p">);</span>

<span class="c1">// Gyroscope FOC (device must be stationary)</span>
<span class="n">imu</span><span class="p">.</span><span class="n">perform_gyro_foc</span><span class="p">(</span><span class="n">ec</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="component-re-trim-crt">
<h3>Component Re-Trim (CRT)<a class="headerlink" href="#component-re-trim-crt" title="Permalink to this heading"></a></h3>
<p>CRT is a feature to compensate for sensitivity changes in the gyroscope that may occur during assembly or over time.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">imu</span><span class="p">.</span><span class="n">perform_crt</span><span class="p">(</span><span class="n">ec</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="built-in-features">
<h3>Built-in Features<a class="headerlink" href="#built-in-features" title="Permalink to this heading"></a></h3>
<p>The BMI270 also supports several on-chip features that can be demonstrated by extending this example:</p>
<ul class="simple">
<li><p><strong>Motion Detection</strong>: Any motion, no motion, significant motion</p></li>
<li><p><strong>Step Counting</strong>: Pedometer functionality</p></li>
<li><p><strong>Activity Recognition</strong>: Walk, run, still classification</p></li>
<li><p><strong>Gesture Detection</strong>: Wrist gestures, tap detection</p></li>
<li><p><strong>FIFO Usage</strong>: Batch data collection</p></li>
<li><p><strong>Low Power Modes</strong>: Optimized for battery applications</p></li>
</ul>
</section>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.bosch-sensortec.com/media/boschsensortec/downloads/datasheets/bst-bmi270-ds000.pdf">BMI270 Datasheet</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Kalman_filter">Kalman Filter Theory</a></p></li>
<li><p><a class="reference external" href="https://x-io.co.uk/res/doc/madgwick_internal_report.pdf">Madgwick Filter Paper</a></p></li>
<li><p><a class="reference external" href="https://esp-cpp.github.io/espp/">ESP-CPP Documentation</a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="bmi270.html" class="btn btn-neutral float-left" title="BMI270 6-Axis IMU" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="icm20948.html" class="btn btn-neutral float-right" title="ICM20948 9-Axis IMU" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022 - 2026, William Emfinger.</p>
  </div>

  <ul class="footer">
        <li>
	    
            
            Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/espressif/sphinx_idf_theme">theme</a>  based on <a href="https://github.com/readthedocs/sphinx_rtd_theme">Read the Docs Sphinx Theme</a>.
         </li>

  </ul> 

</footer>
        </div>
      </div>
    </section>
  </div>

  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>