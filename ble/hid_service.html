<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HID Service - ESP32 -  &mdash; ESPP main documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=a60756f2" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=949a1ff5" />
      <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css?v=851bd809" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=d01aebe5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=ff8fa330"></script>
    <script src="../_static/js/theme.js"></script>

    
        

    <script type="text/javascript">
        DOCUMENTATION_OPTIONS.PAGENAME = 'ble/hid_service';
        DOCUMENTATION_OPTIONS.PROJECT_SLUG = 'esp-cpp';
        DOCUMENTATION_OPTIONS.LATEST_BRANCH_NAME = 'master';
        DOCUMENTATION_OPTIONS.VERSIONS_URL = 'https://dl.espressif.com/dl/esp-idf/idf_versions.js';
        DOCUMENTATION_OPTIONS.LANGUAGES = ["en"];
        DOCUMENTATION_OPTIONS.IDF_TARGET = 'esp32';
        DOCUMENTATION_OPTIONS.HAS_IDF_TARGETS = ["esp32", "esp32s2", "esp32c3"]
        DOCUMENTATION_OPTIONS.RELEASE = 'main';
        DOCUMENTATION_OPTIONS.LANGUAGE_URL = 'en';

    </script>

    <script type="text/javascript" src="https://dl.espressif.com/dl/esp-idf/idf_versions.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="BLE HID Service Example" href="hid_service_example.html" />
    <link rel="prev" title="Google Fast Pair Service (GFPS) Service Example" href="gfps_service_example.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            ESPP
              <img src="../_static/espressif-logo.svg" class="logo" alt="Logo"/>
          </a>

          
            <div class="selectors">
              <select id="target-select" style="width: 150px;" hidden>
                <option value="" disabled selected>Choose target...</option>
              </select>
            </div>
          

          <div class="selectors">
            <select id="version-select" style="width: 150px;" hidden>
              <option value="" disabled selected>Choose version...</option>
            </select>
          </div>

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../adc/index.html">ADC APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../base_component.html">Base Component</a></li>
<li class="toctree-l1"><a class="reference internal" href="../base_peripheral.html">Base Peripheral</a></li>
<li class="toctree-l1"><a class="reference internal" href="../battery/index.html">Battery APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bldc/index.html">BLDC APIs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">BLE APIs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="battery_service.html">Battery Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="ble_gatt_server.html">BLE GATT Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="ble_gatt_server_example.html">BLE GATT Server Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="device_info_service.html">Device Info Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="generic_access_service.html">Generic Access Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="gfps_service.html">Google Fast Pair Service (GFPS) Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="gfps_service_example.html">Google Fast Pair Service (GFPS) Service Example</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">HID Service</a><ul>
<li class="toctree-l3"><a class="reference internal" href="hid_service_example.html">BLE HID Service Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#api-reference">API Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#header-file">Header File</a></li>
<li class="toctree-l4"><a class="reference internal" href="#classes">Classes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="hid_service_example.html">BLE HID Service Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../button.html">Button APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../byte90.html">ALXV Labs Byte90</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controller.html">Controller APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">Command Line Interface (CLI) APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cobs.html">COBS (Consistent Overhead Byte Stuffing)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../color.html">Color APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../csv.html">CSV APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../display/index.html">Display APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distance_sensors/index.html">Distance Sensor APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../encoder/index.html">Encoder APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../esp32_timer_cam.html">ESP32 TimerCam</a></li>
<li class="toctree-l1"><a class="reference internal" href="../esp_box.html">ESP BOX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../event_manager.html">Event Manager APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../file_system.html">File System APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filters/index.html">Filter APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ftp/index.html">FTP APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../haptics/index.html">Haptics APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hid/index.html">HID APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i2c.html">I2C</a></li>
<li class="toctree-l1"><a class="reference internal" href="../imu/index.html">IMU APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interrupt.html">Interrupt APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">Input APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../io_expander/index.html">IO Expander APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iperf_menu.html">Iperf Menu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../joystick.html">Joystick APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../led.html">LED APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../led_driver/index.html">LED Driver Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../led_strip.html">LED Strip APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logger.html">Logging APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m5stack_tab5.html">M5Stack Tab5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../math/index.html">Math APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../matouch_rotary_display.html">MaTouch Rotary Display</a></li>
<li class="toctree-l1"><a class="reference internal" href="../monitor.html">Monitoring APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../motorgo_mini.html">MotorGo Mini</a></li>
<li class="toctree-l1"><a class="reference internal" href="../neopixel.html">Neopixel APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/index.html">Network APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nfc/index.html">NFC APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nvs.html">NVS APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../odrive_ascii.html">ODrive ASCII Protocol Component</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pid.html">PID APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power/index.html">Power Monitoring APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qtpy.html">QtPy ESP32 Pico and QtPy ESP32-S3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qwiicnes.html">QwiicNES</a></li>
<li class="toctree-l1"><a class="reference internal" href="../remote_debug.html">Remote Debug APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rmt.html">Remote Control Transceiver (RMT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rtc/index.html">RTC APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rtsp.html">RTSP APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../runqueue.html">RunQueue APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../seeed_studio_round_display.html">Seeed Studio Round Display</a></li>
<li class="toctree-l1"><a class="reference internal" href="../serialization.html">Serialization APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../state_machine.html">State Machine APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../t_deck.html">LilyGo T-Deck</a></li>
<li class="toctree-l1"><a class="reference internal" href="../t_dongle_s3.html">LilyGo T-Dongle S3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tabulate.html">Tabulate APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../task.html">Task APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thermistor.html">Thermistor APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timer.html">Timer APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wifi/index.html">WiFi APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wrover_kit.html">ESP32-WROVER-KIT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ws_s3_geek.html">Waveshare ESP32-S3 GEEK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ws_s3_lcd_1_47.html">Waveshare ESP32-S3 LCD 1.47”</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ws_s3_touch.html">Waveshare ESP32-S3 TouchLCD</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ESPP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">BLE APIs</a></li>
      <li class="breadcrumb-item active">HID Service</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/esp-cpp/espp/blob/32e8215e/docs/en/ble/hid_service.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="hid-service">
<h1>HID Service<a class="headerlink" href="#hid-service" title="Permalink to this heading"></a></h1>
<p>The <cite>HidService</cite> implements the standard BLE HID service, providing dynamic and
configurable HID input, output, and feature reports from a BLE peripheral to a
BLE central.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="hid_service_example.html">BLE HID Service Example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hid_service_example.html#supported-controllers">Supported Controllers</a></li>
<li class="toctree-l2"><a class="reference internal" href="hid_service_example.html#how-to-use-example">How to use example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="hid_service_example.html#hardware-required">Hardware Required</a></li>
<li class="toctree-l3"><a class="reference internal" href="hid_service_example.html#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="hid_service_example.html#build-and-flash">Build and Flash</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="hid_service_example.html#example-output">Example Output</a></li>
</ul>
</li>
</ul>
</div>
<section id="api-reference">
<h2>API Reference<a class="headerlink" href="#api-reference" title="Permalink to this heading"></a></h2>
<section id="header-file">
<h3>Header File<a class="headerlink" href="#header-file" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/esp-cpp/espp/blob/32e8215e/components/hid_service/include/hid_service.hpp">components/hid_service/include/hid_service.hpp</a></p></li>
</ul>
</section>
<section id="classes">
<h3>Classes<a class="headerlink" href="#classes" title="Permalink to this heading"></a></h3>
<dl class="cpp class">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidServiceE">
<span id="_CPPv3N4espp10HidServiceE"></span><span id="_CPPv2N4espp10HidServiceE"></span><span id="espp::HidService"></span><span class="target" id="classespp_1_1HidService"></span><span class="k"><span class="pre">class</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">HidService</span></span></span><span class="w"> </span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="k"><span class="pre">public</span></span><span class="w"> </span><span class="n"><span class="pre">espp</span></span><span class="p"><span class="pre">::</span></span><a class="reference internal" href="../base_component.html#_CPPv4N4espp13BaseComponentE" title="espp::BaseComponent"><span class="n"><span class="pre">BaseComponent</span></span></a><a class="headerlink" href="#_CPPv4N4espp10HidServiceE" title="Permalink to this definition"></a><br /></dt>
<dd><p>HID Service This class is responsible for creating and managing the HID service. It is responsible for creating and managing the required characteristics per the HID specification. It allows arbitrary input/output/feature HID reports.</p>
<p>NOTE: this is a simplified version of NimBLEHIDDevice, which does not include the <a class="reference internal" href="device_info_service.html#classespp_1_1DeviceInfoService"><span class="std std-ref">DeviceInfoService</span></a> and <a class="reference internal" href="battery_service.html#classespp_1_1BatteryService"><span class="std std-ref">BatteryService</span></a> internally, as <a class="reference internal" href="ble_gatt_server.html#classespp_1_1BleGattServer"><span class="std std-ref">espp::BleGattServer</span></a> already provides the <a class="reference internal" href="device_info_service.html#classespp_1_1DeviceInfoService"><span class="std std-ref">DeviceInfoService</span></a> and <a class="reference internal" href="battery_service.html#classespp_1_1BatteryService"><span class="std std-ref">BatteryService</span></a>.</p>
<p>If you need the <a class="reference internal" href="device_info_service.html#classespp_1_1DeviceInfoService"><span class="std std-ref">DeviceInfoService</span></a> and <a class="reference internal" href="battery_service.html#classespp_1_1BatteryService"><span class="std std-ref">BatteryService</span></a>, you can access them through <a class="reference internal" href="ble_gatt_server.html#classespp_1_1BleGattServer"><span class="std std-ref">espp::BleGattServer</span></a>.</p>
<p><div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="ble_gatt_server.html#classespp_1_1BleGattServer"><span class="std std-ref">BleGattServer</span></a></p>
</div>
</p>
<section id="classespp_1_1HidService_1hid_service_ex1">
<h4>HID Service Example<a class="headerlink" href="#classespp_1_1HidService_1hid_service_ex1" title="Permalink to this heading"></a></h4>
<div class="highlight-cpp notranslate" id="classespp_1_1HidService_1hid_service_ex1"><div class="highlight"><pre><span></span><span class="w">  </span><span class="c1">// NOTE: esp-nimble-cpp already depends on nvs_flash and initializes</span>
<span class="w">  </span><span class="c1">//       nvs_flash in the NimBLEDevice::init(), so we don&#39;t have to do that</span>
<span class="w">  </span><span class="c1">//       to store bonding info</span>

<span class="cp">#if CONFIG_EXAMPLE_AS_XBOX</span>
<span class="w">  </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Configuring as Xbox controller&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// Xbox controller</span>
<span class="w">  </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">vid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x045E</span><span class="p">;</span><span class="w"> </span><span class="c1">// Microsoft</span>
<span class="w">  </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0B13</span><span class="p">;</span><span class="w"> </span><span class="c1">// Xbox One Controller (model 1708)</span>
<span class="w">  </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">product_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0100</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">software_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">firmware_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;5.9.2709.0&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">hardware_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">device_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Xbox One Controller&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">advertised_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">device_name</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">manufacturer_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Microsoft&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">model_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1708&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">serial_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1234567890&quot;</span><span class="p">;</span>

<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">GamepadInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">espp</span><span class="o">::</span><span class="n">XboxGamepadInputReport</span><span class="o">&lt;&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">GamepadInput</span><span class="w"> </span><span class="n">gamepad_input_report</span><span class="p">;</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_buttons</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GamepadInput</span><span class="o">::</span><span class="n">button_count</span><span class="p">;</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">input_report_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GamepadInput</span><span class="o">::</span><span class="n">ID</span><span class="p">;</span>

<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">BatteryReport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">espp</span><span class="o">::</span><span class="n">XboxBatteryInputReport</span><span class="o">&lt;&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">BatteryReport</span><span class="w"> </span><span class="n">battery_input_report</span><span class="p">;</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">battery_report_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BatteryReport</span><span class="o">::</span><span class="n">ID</span><span class="p">;</span>

<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">led_output_report_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_leds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">GamepadLeds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">espp</span><span class="o">::</span><span class="n">GamepadLedOutputReport</span><span class="o">&lt;</span><span class="n">num_leds</span><span class="p">,</span><span class="w"> </span><span class="n">led_output_report_id</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">GamepadLeds</span><span class="w"> </span><span class="n">gamepad_leds_report</span><span class="p">;</span>

<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">RumbleReport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">espp</span><span class="o">::</span><span class="n">XboxRumbleOutputReport</span><span class="o">&lt;&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">RumbleReport</span><span class="w"> </span><span class="n">gamepad_rumble_report</span><span class="p">;</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">rumble_output_report_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RumbleReport</span><span class="o">::</span><span class="n">ID</span><span class="p">;</span>

<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">hid</span><span class="o">::</span><span class="nn">page</span><span class="p">;</span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">hid</span><span class="o">::</span><span class="nn">rdf</span><span class="p">;</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">raw_descriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">descriptor</span><span class="p">(</span><span class="n">usage_page</span><span class="o">&lt;</span><span class="n">generic_desktop</span><span class="o">&gt;</span><span class="p">(),</span><span class="w"> </span><span class="n">usage</span><span class="p">(</span><span class="n">generic_desktop</span><span class="o">::</span><span class="n">GAMEPAD</span><span class="p">),</span>
<span class="w">                                   </span><span class="n">collection</span><span class="o">::</span><span class="n">application</span><span class="p">(</span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">get_descriptor</span><span class="p">(),</span>
<span class="w">                                                           </span><span class="n">gamepad_rumble_report</span><span class="p">.</span><span class="n">get_descriptor</span><span class="p">(),</span>
<span class="w">                                                           </span><span class="n">battery_input_report</span><span class="p">.</span><span class="n">get_descriptor</span><span class="p">(),</span>
<span class="w">                                                           </span><span class="n">gamepad_leds_report</span><span class="p">.</span><span class="n">get_descriptor</span><span class="p">()));</span>

<span class="cp">#elif CONFIG_EXAMPLE_AS_SWITCH_PRO</span>
<span class="w">  </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Configuring as Switch Pro controller&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Switch Pro controller</span>
<span class="w">  </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">vid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x057E</span><span class="p">;</span><span class="w"> </span><span class="c1">// Nintendo</span>
<span class="w">  </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x2009</span><span class="p">;</span><span class="w"> </span><span class="c1">// Switch Pro Controller</span>
<span class="w">  </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">product_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0100</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">software_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">firmware_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">hardware_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">device_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Pro Controller&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">advertised_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">device_name</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">manufacturer_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Nintendo&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">model_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;HAC-013&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">serial_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1234567890&quot;</span><span class="p">;</span>

<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">GamepadInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">espp</span><span class="o">::</span><span class="n">SwitchProGamepadInputReport</span><span class="o">&lt;&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">GamepadInput</span><span class="w"> </span><span class="n">gamepad_input_report</span><span class="p">;</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_report_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GamepadInput</span><span class="o">::</span><span class="n">num_data_bytes</span><span class="p">;</span>
<span class="w">  </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Report size: {} bytes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">num_report_bytes</span><span class="p">);</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_buttons</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GamepadInput</span><span class="o">::</span><span class="n">button_count</span><span class="p">;</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">input_report_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GamepadInput</span><span class="o">::</span><span class="n">ID</span><span class="p">;</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">raw_descriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">espp</span><span class="o">::</span><span class="n">switch_pro_descriptor</span><span class="p">();</span>
<span class="cp">#elif CONFIG_EXAMPLE_AS_PLAYSTATION_DUALSENSE_BLE</span>
<span class="w">  </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Configuring as Playstation Dualsense BLE controller&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Playstation Dualsense BLE controller</span>
<span class="w">  </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">vid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x054C</span><span class="p">;</span><span class="w"> </span><span class="c1">// Sony</span>
<span class="w">  </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0CE6</span><span class="p">;</span><span class="w"> </span><span class="c1">// DualSense Wireless Controller</span>
<span class="w">  </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">product_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0100</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">software_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">firmware_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">hardware_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">device_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Dualsense Wireless Controller&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">advertised_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Wireless Controller&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// must be shorter to fit in adv packet</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">manufacturer_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Sony&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">model_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;CFI-ZCT1W&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">serial_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1234567890&quot;</span><span class="p">;</span>

<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">GamepadInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">espp</span><span class="o">::</span><span class="n">PlaystationDualsenseBLEComplexInputReport</span><span class="o">&lt;&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">GamepadInput</span><span class="w"> </span><span class="n">gamepad_input_report</span><span class="p">;</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_report_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GamepadInput</span><span class="o">::</span><span class="n">num_data_bytes</span><span class="p">;</span>
<span class="w">  </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Report size: {} bytes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">num_report_bytes</span><span class="p">);</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_buttons</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GamepadInput</span><span class="o">::</span><span class="n">button_count</span><span class="p">;</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">input_report_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GamepadInput</span><span class="o">::</span><span class="n">ID</span><span class="p">;</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">raw_descriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">espp</span><span class="o">::</span><span class="n">playstation_dualsense_ble_descriptor</span><span class="p">();</span>
<span class="cp">#elif CONFIG_EXAMPLE_AS_PLAYSTATION_DUALSHOCK4_BLE</span>
<span class="w">  </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Configuring as Playstation DualShock 4 BLE controller&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Playstation DualShock 4 BLE controller</span>
<span class="w">  </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">vid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x054C</span><span class="p">;</span><span class="w"> </span><span class="c1">// Sony</span>
<span class="w">  </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x09CC</span><span class="p">;</span><span class="w"> </span><span class="c1">// DualShock 4 Wireless Controller (CUH-ZCT2 series)</span>
<span class="w">  </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">product_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0100</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">software_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">firmware_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">hardware_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">device_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Wireless Controller&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">advertised_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Wireless Controller&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">manufacturer_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Sony&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">model_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;CUH-ZCT2&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">serial_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1234567890&quot;</span><span class="p">;</span>

<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">GamepadInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">espp</span><span class="o">::</span><span class="n">PS4DualShock4GamepadInputReport</span><span class="o">&lt;&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">GamepadInput</span><span class="w"> </span><span class="n">gamepad_input_report</span><span class="p">;</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_report_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GamepadInput</span><span class="o">::</span><span class="n">num_data_bytes</span><span class="p">;</span>
<span class="w">  </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Report size: {} bytes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">num_report_bytes</span><span class="p">);</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_buttons</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GamepadInput</span><span class="o">::</span><span class="n">button_count</span><span class="p">;</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">input_report_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GamepadInput</span><span class="o">::</span><span class="n">ID</span><span class="p">;</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">raw_descriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">espp</span><span class="o">::</span><span class="n">ps4_dualshock4_descriptor</span><span class="p">();</span>
<span class="cp">#else</span>
<span class="cp">#error                                                                                             \</span>
<span class="cp">    &quot;You must define one of CONFIG_EXAMPLE_AS_XBOX, CONFIG_EXAMPLE_AS_SWITCH_PRO, CONFIG_EXAMPLE_AS_PLAYSTATION_DUALSHOCK4_BLE, or CONFIG_EXAMPLE_AS_PLAYSTATION_DUALSENSE_BLE&quot;</span>
<span class="cp">#endif</span>

<span class="w">  </span><span class="c1">// create the GATT server</span>
<span class="w">  </span><span class="n">espp</span><span class="o">::</span><span class="n">BleGattServer</span><span class="w"> </span><span class="n">ble_gatt_server</span><span class="p">;</span>
<span class="w">  </span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">set_log_level</span><span class="p">(</span><span class="n">espp</span><span class="o">::</span><span class="n">Logger</span><span class="o">::</span><span class="n">Verbosity</span><span class="o">::</span><span class="n">INFO</span><span class="p">);</span>
<span class="w">  </span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">set_callbacks</span><span class="p">({</span>
<span class="w">      </span><span class="p">.</span><span class="n">connect_callback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="k">const</span><span class="w"> </span><span class="n">NimBLEConnInfo</span><span class="w"> </span><span class="o">&amp;</span><span class="n">conn_info</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Device connected&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="p">.</span><span class="n">disconnect_callback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">conn_info</span><span class="p">,</span>
<span class="w">                                 </span><span class="k">auto</span><span class="w"> </span><span class="n">reason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Device disconnected: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="p">);</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="p">.</span><span class="n">authentication_complete_callback</span><span class="w"> </span><span class="o">=</span>
<span class="w">          </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="k">const</span><span class="w"> </span><span class="n">NimBLEConnInfo</span><span class="w"> </span><span class="o">&amp;</span><span class="n">conn_info</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Device authenticated&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="c1">// NOTE: this is optional, if you don&#39;t provide this callback, it will</span>
<span class="w">      </span><span class="c1">// perform the exactly function as below:</span>
<span class="w">      </span><span class="p">.</span><span class="n">get_passkey_callback</span><span class="w"> </span><span class="o">=</span>
<span class="w">          </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Getting passkey&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">NimBLEDevice</span><span class="o">::</span><span class="n">getSecurityPasskey</span><span class="p">();</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">      </span><span class="c1">// NOTE: this is optional, if you don&#39;t provide this callback, it will</span>
<span class="w">      </span><span class="c1">// perform the exactly function as below:</span>
<span class="w">      </span><span class="p">.</span><span class="n">confirm_passkey_callback</span><span class="w"> </span><span class="o">=</span>
<span class="w">          </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="k">const</span><span class="w"> </span><span class="n">NimBLEConnInfo</span><span class="w"> </span><span class="o">&amp;</span><span class="n">conn_info</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">passkey</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Confirming passkey: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">passkey</span><span class="p">);</span>
<span class="w">            </span><span class="n">NimBLEDevice</span><span class="o">::</span><span class="n">injectConfirmPasskey</span><span class="p">(</span><span class="n">conn_info</span><span class="p">,</span>
<span class="w">                                               </span><span class="n">passkey</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NimBLEDevice</span><span class="o">::</span><span class="n">getSecurityPasskey</span><span class="p">());</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">  </span><span class="p">});</span>
<span class="w">  </span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">device_name</span><span class="p">);</span>
<span class="cp">#if CONFIG_BT_NIMBLE_EXT_ADV</span>
<span class="cp">#error                                                                                             \</span>
<span class="cp">    &quot;This example does not support extended advertising, as iOS does not seem to show ext advertisements in their bluetooth settings menu (even if you turn on legacy advertising)&quot;</span>
<span class="cp">#endif</span>
<span class="cp">#if !CONFIG_BT_NIMBLE_EXT_ADV</span>
<span class="w">  </span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">set_advertise_on_disconnect</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="w">  </span><span class="c1">// NOTE: for information about the low-level NVS storage on esp chips, see</span>
<span class="w">  </span><span class="c1">// ~/esp/esp-idf/components/bt/host/nimble/nimble/nimble/host/store/config/src/ble_store_nvs.c</span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="c1">// now set the device callbacks to override the default one from esp-nimble-cpp</span>
<span class="w">  </span><span class="n">NimBLEDevice</span><span class="o">::</span><span class="n">setDeviceCallbacks</span><span class="p">(</span><span class="o">&amp;</span><span class="n">device_callbacks</span><span class="p">);</span>
<span class="w">  </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">max_bonds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MYNEWT_VAL</span><span class="p">(</span><span class="n">BLE_STORE_MAX_BONDS</span><span class="p">);</span>
<span class="w">  </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Max bonds: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">max_bonds</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// print the bonded devices as well</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">paired_device_addresses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">get_paired_devices</span><span class="p">();</span>
<span class="w">  </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Paired devices: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">paired_device_addresses</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">addr</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">paired_device_addresses</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;          Addr:  {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">.</span><span class="n">toString</span><span class="p">());</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// for HID we need to set some security</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">bonding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">mitm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">secure_connections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">  </span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">set_security</span><span class="p">(</span><span class="n">bonding</span><span class="p">,</span><span class="w"> </span><span class="n">mitm</span><span class="p">,</span><span class="w"> </span><span class="n">secure_connections</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// and some i/o and key config</span>
<span class="w">  </span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">set_io_capabilities</span><span class="p">(</span><span class="n">BLE_HS_IO_NO_INPUT_OUTPUT</span><span class="p">);</span>
<span class="w">  </span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">set_init_key_distribution</span><span class="p">(</span><span class="n">BLE_SM_PAIR_KEY_DIST_ENC</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">BLE_SM_PAIR_KEY_DIST_ID</span><span class="p">);</span>
<span class="w">  </span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">set_resp_key_distribution</span><span class="p">(</span><span class="n">BLE_SM_PAIR_KEY_DIST_ENC</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">BLE_SM_PAIR_KEY_DIST_ID</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// let&#39;s create a HID service</span>
<span class="w">  </span><span class="n">espp</span><span class="o">::</span><span class="n">HidService</span><span class="w"> </span><span class="n">hid_service</span><span class="p">;</span>
<span class="w">  </span><span class="n">hid_service</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">server</span><span class="p">());</span>

<span class="w">  </span><span class="c1">// configure it some</span>
<span class="w">  </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">country_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00</span><span class="p">;</span>
<span class="w">  </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">hid_info_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x01</span><span class="p">;</span>
<span class="w">  </span><span class="n">hid_service</span><span class="p">.</span><span class="n">set_info</span><span class="p">(</span><span class="n">country_code</span><span class="p">,</span><span class="w"> </span><span class="n">hid_info_flags</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Generate the report descriptor for the gamepad</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">descriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">raw_descriptor</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">raw_descriptor</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>

<span class="w">  </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Report Descriptor:&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;  Size: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">descriptor</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">  </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;  Data: {::#02x}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">descriptor</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// set the report map (vector of bytes)</span>
<span class="w">  </span><span class="n">hid_service</span><span class="p">.</span><span class="n">set_report_map</span><span class="p">(</span><span class="n">descriptor</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Only configure the battery, led, or rumble reports if we are emulating an</span>
<span class="w">  </span><span class="c1">// xbox controller. For PS4, we need to set up feature and output reports.</span>
<span class="cp">#if CONFIG_EXAMPLE_AS_XBOX</span>
<span class="w">  </span><span class="c1">// use the HID service to make an input report characteristic</span>
<span class="w">  </span><span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">input_report</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hid_service</span><span class="p">.</span><span class="n">input_report</span><span class="p">(</span><span class="n">input_report_id</span><span class="p">);</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">battery_report</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hid_service</span><span class="p">.</span><span class="n">input_report</span><span class="p">(</span><span class="n">battery_report_id</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// use the HID service to make an output report characteristic</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">led_output_report</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hid_service</span><span class="p">.</span><span class="n">output_report</span><span class="p">(</span><span class="n">led_output_report_id</span><span class="p">);</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">rumble_output_report</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hid_service</span><span class="p">.</span><span class="n">output_report</span><span class="p">(</span><span class="n">rumble_output_report_id</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// now make some characteristic callbacks for the Rumble Output characteristic</span>
<span class="w">  </span><span class="c1">// and the LED output characteristic</span>
<span class="w">  </span><span class="k">class</span><span class="w"> </span><span class="nc">RumbleCallbacks</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">NimBLECharacteristicCallbacks</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">RumbleReport</span><span class="w"> </span><span class="o">*</span><span class="n">report</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">espp</span><span class="o">::</span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">espp</span><span class="o">::</span><span class="n">Logger</span><span class="p">({.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;RumbleCallbacks&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">espp</span><span class="o">::</span><span class="n">Logger</span><span class="o">::</span><span class="n">Verbosity</span><span class="o">::</span><span class="n">INFO</span><span class="p">});</span>

<span class="w">  </span><span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="k">explicit</span><span class="w"> </span><span class="n">RumbleCallbacks</span><span class="p">(</span><span class="n">RumbleReport</span><span class="w"> </span><span class="o">*</span><span class="n">report</span><span class="p">)</span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">report</span><span class="p">(</span><span class="n">report</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">onWrite</span><span class="p">(</span><span class="n">NimBLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="n">pCharacteristic</span><span class="p">,</span><span class="w"> </span><span class="n">NimBLEConnInfo</span><span class="w"> </span><span class="o">&amp;</span><span class="n">connInfo</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// parse the output using the report</span>
<span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pCharacteristic</span><span class="o">-&gt;</span><span class="n">getValue</span><span class="p">();</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">report</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="n">report</span><span class="o">-&gt;</span><span class="n">set_data</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="w">      </span><span class="c1">// now print the state of the report</span>
<span class="w">      </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">report</span><span class="o">-&gt;</span><span class="n">get_enabled</span><span class="p">();</span>
<span class="w">      </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">left_motor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">report</span><span class="o">-&gt;</span><span class="n">get_magnitude</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">      </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">right_motor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">report</span><span class="o">-&gt;</span><span class="n">get_magnitude</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">      </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">left_trigger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">report</span><span class="o">-&gt;</span><span class="n">get_magnitude</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="w">      </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">right_trigger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">report</span><span class="o">-&gt;</span><span class="n">get_magnitude</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="w">      </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">report</span><span class="o">-&gt;</span><span class="n">get_duration</span><span class="p">();</span>
<span class="w">      </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">delay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">report</span><span class="o">-&gt;</span><span class="n">get_start_delay</span><span class="p">();</span>
<span class="w">      </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">loop_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">report</span><span class="o">-&gt;</span><span class="n">get_loop_count</span><span class="p">();</span>
<span class="w">      </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;enabled: 0x{:02x}, left_motor: {}, right_motor: {}, left_trigger: {}, &quot;</span>
<span class="w">                  </span><span class="s">&quot;right_trigger: {}, duration: {}, delay: {}, loop_count: {}&quot;</span><span class="p">,</span>
<span class="w">                  </span><span class="n">enabled</span><span class="p">,</span><span class="w"> </span><span class="n">left_motor</span><span class="p">,</span><span class="w"> </span><span class="n">right_motor</span><span class="p">,</span><span class="w"> </span><span class="n">left_trigger</span><span class="p">,</span><span class="w"> </span><span class="n">right_trigger</span><span class="p">,</span><span class="w"> </span><span class="n">duration</span><span class="p">,</span><span class="w"> </span><span class="n">delay</span><span class="p">,</span>
<span class="w">                  </span><span class="n">loop_count</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="k">class</span><span class="w"> </span><span class="nc">LEDCallbacks</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">NimBLECharacteristicCallbacks</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">GamepadLeds</span><span class="w"> </span><span class="o">*</span><span class="n">report</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">espp</span><span class="o">::</span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">espp</span><span class="o">::</span><span class="n">Logger</span><span class="p">({.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;LEDCallbacks&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">espp</span><span class="o">::</span><span class="n">Logger</span><span class="o">::</span><span class="n">Verbosity</span><span class="o">::</span><span class="n">INFO</span><span class="p">});</span>

<span class="w">  </span><span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="k">explicit</span><span class="w"> </span><span class="n">LEDCallbacks</span><span class="p">(</span><span class="n">GamepadLeds</span><span class="w"> </span><span class="o">*</span><span class="n">report</span><span class="p">)</span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">report</span><span class="p">(</span><span class="n">report</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">onWrite</span><span class="p">(</span><span class="n">NimBLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="n">pCharacteristic</span><span class="p">,</span><span class="w"> </span><span class="n">NimBLEConnInfo</span><span class="w"> </span><span class="o">&amp;</span><span class="n">connInfo</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// parse the output using the report</span>
<span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pCharacteristic</span><span class="o">-&gt;</span><span class="n">getValue</span><span class="p">();</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">report</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="n">report</span><span class="o">-&gt;</span><span class="n">set_data</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="w">      </span><span class="c1">// now print the state of the report</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">report</span><span class="o">-&gt;</span><span class="n">num_leds</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">report</span><span class="o">-&gt;</span><span class="n">get_led</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;LED {}: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">enabled</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="n">RumbleCallbacks</span><span class="w"> </span><span class="nf">rumble_callbacks</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gamepad_rumble_report</span><span class="p">);</span>
<span class="w">  </span><span class="n">LEDCallbacks</span><span class="w"> </span><span class="nf">led_callbacks</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gamepad_leds_report</span><span class="p">);</span>
<span class="w">  </span><span class="n">rumble_output_report</span><span class="o">-&gt;</span><span class="n">setCallbacks</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rumble_callbacks</span><span class="p">);</span>
<span class="w">  </span><span class="n">led_output_report</span><span class="o">-&gt;</span><span class="n">setCallbacks</span><span class="p">(</span><span class="o">&amp;</span><span class="n">led_callbacks</span><span class="p">);</span>
<span class="cp">#elif CONFIG_EXAMPLE_AS_SWITCH_PRO</span>
<span class="w">  </span><span class="c1">// use the HID service to make an input report characteristic</span>
<span class="w">  </span><span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">input_report</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hid_service</span><span class="p">.</span><span class="n">input_report</span><span class="p">(</span><span class="n">input_report_id</span><span class="p">);</span>
<span class="cp">#elif CONFIG_EXAMPLE_AS_PLAYSTATION_DUALSENSE_BLE</span>
<span class="w">  </span><span class="c1">// use the HID service to make an input report characteristic</span>
<span class="w">  </span><span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">input_report_01</span><span class="w"> </span><span class="o">=</span>
<span class="w">      </span><span class="n">hid_service</span><span class="p">.</span><span class="n">input_report</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// only one sent over ble before reading feature 05</span>
<span class="w">  </span><span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">input_report</span><span class="w"> </span><span class="o">=</span>
<span class="w">      </span><span class="n">hid_service</span><span class="p">.</span><span class="n">input_report</span><span class="p">(</span><span class="n">input_report_id</span><span class="p">);</span><span class="w"> </span><span class="c1">// full report sent after reading feature 05</span>

<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">SimpleInputReport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">espp</span><span class="o">::</span><span class="n">PlaystationDualsenseBLESimpleInputReport</span><span class="o">&lt;&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">SimpleInputReport</span><span class="w"> </span><span class="n">simple_input_report</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// go ahead and set the input reports for id 1 and id 49 so that they&#39;re ready to be read</span>
<span class="w">  </span><span class="n">input_report_01</span><span class="o">-&gt;</span><span class="n">setValue</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">SimpleInputReport</span><span class="o">::</span><span class="n">num_data_bytes</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>
<span class="w">  </span><span class="n">input_report</span><span class="o">-&gt;</span><span class="n">setValue</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">GamepadInput</span><span class="o">::</span><span class="n">num_data_bytes</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>

<span class="w">  </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Set input report {} to {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">simple_input_report</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="n">simple_input_report</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// now make some characteristic callbacks for when the output report is</span>
<span class="w">  </span><span class="c1">// written to</span>
<span class="w">  </span><span class="k">class</span><span class="w"> </span><span class="nc">OutputCallbacks</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">NimBLECharacteristicCallbacks</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">report_id</span><span class="p">;</span>
<span class="w">    </span><span class="n">espp</span><span class="o">::</span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">espp</span><span class="o">::</span><span class="n">Logger</span><span class="p">({.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;OutputCallbacks&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">espp</span><span class="o">::</span><span class="n">Logger</span><span class="o">::</span><span class="n">Verbosity</span><span class="o">::</span><span class="n">INFO</span><span class="p">});</span>

<span class="w">  </span><span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="k">explicit</span><span class="w"> </span><span class="n">OutputCallbacks</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">id</span><span class="p">)</span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">report_id</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">onWrite</span><span class="p">(</span><span class="n">NimBLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="n">pCharacteristic</span><span class="p">,</span><span class="w"> </span><span class="n">NimBLEConnInfo</span><span class="w"> </span><span class="o">&amp;</span><span class="n">connInfo</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// parse the output using the report</span>
<span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pCharacteristic</span><span class="o">-&gt;</span><span class="n">getValue</span><span class="p">();</span>
<span class="w">      </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Output report (id={})[len={}]: {::#02x}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">report_id</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="c1">// std::array&lt;uint8_t, 9&gt; output_report_ids = {49, 50, 51, 52, 53, 54, 55, 56, 57};</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="w"> </span><span class="n">output_report_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">49</span><span class="p">};</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">report_id</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">output_report_ids</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">ps_output_report</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hid_service</span><span class="p">.</span><span class="n">output_report</span><span class="p">(</span><span class="n">report_id</span><span class="p">);</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">output_callbacks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">OutputCallbacks</span><span class="o">&gt;</span><span class="p">(</span><span class="n">report_id</span><span class="p">);</span>
<span class="w">    </span><span class="n">ps_output_report</span><span class="o">-&gt;</span><span class="n">setCallbacks</span><span class="p">(</span><span class="n">output_callbacks</span><span class="p">.</span><span class="n">get</span><span class="p">());</span>
<span class="w">    </span><span class="n">output_callbacks</span><span class="p">.</span><span class="n">release</span><span class="p">();</span><span class="w"> </span><span class="c1">// the hid service will now own the callbacks</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// now make some characteristic callbacks for when the feature report is</span>
<span class="w">  </span><span class="c1">// written to</span>
<span class="w">  </span><span class="k">class</span><span class="w"> </span><span class="nc">FeatureCallbacks</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">NimBLECharacteristicCallbacks</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">report_id</span><span class="p">;</span>
<span class="w">    </span><span class="n">espp</span><span class="o">::</span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">espp</span><span class="o">::</span><span class="n">Logger</span><span class="p">({.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;FeatureCallbacks&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">espp</span><span class="o">::</span><span class="n">Logger</span><span class="o">::</span><span class="n">Verbosity</span><span class="o">::</span><span class="n">INFO</span><span class="p">});</span>

<span class="w">  </span><span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="k">explicit</span><span class="w"> </span><span class="n">FeatureCallbacks</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">id</span><span class="p">)</span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">report_id</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">onWrite</span><span class="p">(</span><span class="n">NimBLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="n">pCharacteristic</span><span class="p">,</span><span class="w"> </span><span class="n">NimBLEConnInfo</span><span class="w"> </span><span class="o">&amp;</span><span class="n">connInfo</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// parse the feature using the report</span>
<span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pCharacteristic</span><span class="o">-&gt;</span><span class="n">getValue</span><span class="p">();</span>
<span class="w">      </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Feature report (id={})[len={}]: {::#02x}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">report_id</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="c1">// std::array&lt;uint8_t, 12&gt; feature_report_ids = {5, 8, 9, 32, 34, 128, 129, 130, 131, 241, 242,</span>
<span class="w">  </span><span class="c1">// 240};</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">feature_report_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">};</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">report_id</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">feature_report_ids</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">ps_feature_report</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hid_service</span><span class="p">.</span><span class="n">feature_report</span><span class="p">(</span><span class="n">report_id</span><span class="p">);</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">feature_callbacks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">FeatureCallbacks</span><span class="o">&gt;</span><span class="p">(</span><span class="n">report_id</span><span class="p">);</span>
<span class="w">    </span><span class="n">ps_feature_report</span><span class="o">-&gt;</span><span class="n">setCallbacks</span><span class="p">(</span><span class="n">feature_callbacks</span><span class="p">.</span><span class="n">get</span><span class="p">());</span>
<span class="w">    </span><span class="n">feature_callbacks</span><span class="p">.</span><span class="n">release</span><span class="p">();</span><span class="w"> </span><span class="c1">// the hid service will now own the callbacks</span>
<span class="w">  </span><span class="p">}</span>
<span class="cp">#elif CONFIG_EXAMPLE_AS_PLAYSTATION_DUALSHOCK4_BLE</span>
<span class="w">  </span><span class="c1">// use the HID service to make an input report characteristic</span>
<span class="w">  </span><span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">input_report</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hid_service</span><span class="p">.</span><span class="n">input_report</span><span class="p">(</span><span class="n">input_report_id</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// PS4 uses report ID 0x05 for output (31 bytes)</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">ps4_output_report</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hid_service</span><span class="p">.</span><span class="n">output_report</span><span class="p">(</span><span class="mh">0x05</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// PS4 uses feature reports for device info and configuration</span>
<span class="w">  </span><span class="c1">// Report IDs: 0x02 (37 bytes), 0x04 (41 bytes), 0xF1 (63 bytes), 0xF2 (63 bytes)</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">ps4_feature_02</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hid_service</span><span class="p">.</span><span class="n">feature_report</span><span class="p">(</span><span class="mh">0x02</span><span class="p">);</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">ps4_feature_04</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hid_service</span><span class="p">.</span><span class="n">feature_report</span><span class="p">(</span><span class="mh">0x04</span><span class="p">);</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">ps4_feature_f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hid_service</span><span class="p">.</span><span class="n">feature_report</span><span class="p">(</span><span class="mh">0xF1</span><span class="p">);</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">ps4_feature_f2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hid_service</span><span class="p">.</span><span class="n">feature_report</span><span class="p">(</span><span class="mh">0xF2</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Set up callbacks for output and feature reports</span>
<span class="w">  </span><span class="k">class</span><span class="w"> </span><span class="nc">PS4OutputCallbacks</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">NimBLECharacteristicCallbacks</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">report_id</span><span class="p">;</span>
<span class="w">    </span><span class="n">espp</span><span class="o">::</span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">espp</span><span class="o">::</span><span class="n">Logger</span><span class="p">({.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PS4OutputCallbacks&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">espp</span><span class="o">::</span><span class="n">Logger</span><span class="o">::</span><span class="n">Verbosity</span><span class="o">::</span><span class="n">INFO</span><span class="p">});</span>

<span class="w">  </span><span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="k">explicit</span><span class="w"> </span><span class="n">PS4OutputCallbacks</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">id</span><span class="p">)</span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">report_id</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">onWrite</span><span class="p">(</span><span class="n">NimBLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="n">pCharacteristic</span><span class="p">,</span><span class="w"> </span><span class="n">NimBLEConnInfo</span><span class="w"> </span><span class="o">&amp;</span><span class="n">connInfo</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pCharacteristic</span><span class="o">-&gt;</span><span class="n">getValue</span><span class="p">();</span>
<span class="w">      </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;PS4 Output report (id=0x{:02X})[len={}]: {::#02x}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">report_id</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span>
<span class="w">                  </span><span class="n">data</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">class</span><span class="w"> </span><span class="nc">PS4FeatureCallbacks</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">NimBLECharacteristicCallbacks</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">report_id</span><span class="p">;</span>
<span class="w">    </span><span class="n">espp</span><span class="o">::</span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">espp</span><span class="o">::</span><span class="n">Logger</span><span class="p">({.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PS4FeatureCallbacks&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">espp</span><span class="o">::</span><span class="n">Logger</span><span class="o">::</span><span class="n">Verbosity</span><span class="o">::</span><span class="n">INFO</span><span class="p">});</span>

<span class="w">  </span><span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="k">explicit</span><span class="w"> </span><span class="n">PS4FeatureCallbacks</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">id</span><span class="p">)</span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">report_id</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">onWrite</span><span class="p">(</span><span class="n">NimBLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="n">pCharacteristic</span><span class="p">,</span><span class="w"> </span><span class="n">NimBLEConnInfo</span><span class="w"> </span><span class="o">&amp;</span><span class="n">connInfo</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pCharacteristic</span><span class="o">-&gt;</span><span class="n">getValue</span><span class="p">();</span>
<span class="w">      </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;PS4 Feature report (id=0x{:02X})[len={}]: {::#02x}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">report_id</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span>
<span class="w">                  </span><span class="n">data</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">onRead</span><span class="p">(</span><span class="n">NimBLECharacteristic</span><span class="w"> </span><span class="o">*</span><span class="n">pCharacteristic</span><span class="p">,</span><span class="w"> </span><span class="n">NimBLEConnInfo</span><span class="w"> </span><span class="o">&amp;</span><span class="n">connInfo</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pCharacteristic</span><span class="o">-&gt;</span><span class="n">getValue</span><span class="p">();</span>
<span class="w">      </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;PS4 Feature report read (id=0x{:02X})[len={}]: {::#02x}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">report_id</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span>
<span class="w">                  </span><span class="n">data</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">output_callbacks_05</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">PS4OutputCallbacks</span><span class="o">&gt;</span><span class="p">(</span><span class="mh">0x05</span><span class="p">);</span>
<span class="w">  </span><span class="n">ps4_output_report</span><span class="o">-&gt;</span><span class="n">setCallbacks</span><span class="p">(</span><span class="n">output_callbacks_05</span><span class="p">.</span><span class="n">get</span><span class="p">());</span>
<span class="w">  </span><span class="n">output_callbacks_05</span><span class="p">.</span><span class="n">release</span><span class="p">();</span>

<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">feature_callbacks_02</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">PS4FeatureCallbacks</span><span class="o">&gt;</span><span class="p">(</span><span class="mh">0x02</span><span class="p">);</span>
<span class="w">  </span><span class="n">ps4_feature_02</span><span class="o">-&gt;</span><span class="n">setCallbacks</span><span class="p">(</span><span class="n">feature_callbacks_02</span><span class="p">.</span><span class="n">get</span><span class="p">());</span>
<span class="w">  </span><span class="n">feature_callbacks_02</span><span class="p">.</span><span class="n">release</span><span class="p">();</span>

<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">feature_callbacks_04</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">PS4FeatureCallbacks</span><span class="o">&gt;</span><span class="p">(</span><span class="mh">0x04</span><span class="p">);</span>
<span class="w">  </span><span class="n">ps4_feature_04</span><span class="o">-&gt;</span><span class="n">setCallbacks</span><span class="p">(</span><span class="n">feature_callbacks_04</span><span class="p">.</span><span class="n">get</span><span class="p">());</span>
<span class="w">  </span><span class="n">feature_callbacks_04</span><span class="p">.</span><span class="n">release</span><span class="p">();</span>

<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">feature_callbacks_f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">PS4FeatureCallbacks</span><span class="o">&gt;</span><span class="p">(</span><span class="mh">0xF1</span><span class="p">);</span>
<span class="w">  </span><span class="n">ps4_feature_f1</span><span class="o">-&gt;</span><span class="n">setCallbacks</span><span class="p">(</span><span class="n">feature_callbacks_f1</span><span class="p">.</span><span class="n">get</span><span class="p">());</span>
<span class="w">  </span><span class="n">feature_callbacks_f1</span><span class="p">.</span><span class="n">release</span><span class="p">();</span>

<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">feature_callbacks_f2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">PS4FeatureCallbacks</span><span class="o">&gt;</span><span class="p">(</span><span class="mh">0xF2</span><span class="p">);</span>
<span class="w">  </span><span class="n">ps4_feature_f2</span><span class="o">-&gt;</span><span class="n">setCallbacks</span><span class="p">(</span><span class="n">feature_callbacks_f2</span><span class="p">.</span><span class="n">get</span><span class="p">());</span>
<span class="w">  </span><span class="n">feature_callbacks_f2</span><span class="p">.</span><span class="n">release</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// Initialize feature reports with default data</span>
<span class="w">  </span><span class="c1">// Feature 0xF1 contains device info (MAC address at offset 1-6)</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">feature_f1_data</span><span class="p">(</span><span class="mi">63</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// Set some default MAC address (will be overwritten by real MAC)</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">ble_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NimBLEDevice</span><span class="o">::</span><span class="n">getAddress</span><span class="p">();</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">mac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ble_addr</span><span class="p">.</span><span class="n">getVal</span><span class="p">();</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">feature_f1_data</span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mac</span><span class="p">[</span><span class="mi">5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="p">];</span><span class="w"> </span><span class="c1">// MAC is in reverse order</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">ps4_feature_f1</span><span class="o">-&gt;</span><span class="n">setValue</span><span class="p">(</span><span class="n">feature_f1_data</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Feature 0xF2 contains firmware version info</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">feature_f2_data</span><span class="p">(</span><span class="mi">63</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">ps4_feature_f2</span><span class="o">-&gt;</span><span class="n">setValue</span><span class="p">(</span><span class="n">feature_f2_data</span><span class="p">);</span>
<span class="cp">#endif </span><span class="c1">// CONFIG_EXAMPLE_AS_XBOX</span>

<span class="w">  </span><span class="c1">// now that we&#39;ve made the input characteristic, we can start the service</span>
<span class="w">  </span><span class="n">hid_service</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
<span class="w">  </span><span class="c1">// starts the device info service and battery service, see</span>
<span class="w">  </span><span class="c1">// hid_service_example for more info</span>
<span class="w">  </span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">start_services</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// now start the gatt server</span>
<span class="w">  </span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// let&#39;s set some of the service data</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">battery_service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">battery_service</span><span class="p">();</span>
<span class="w">  </span><span class="n">battery_service</span><span class="p">.</span><span class="n">set_battery_level</span><span class="p">(</span><span class="mi">99</span><span class="p">);</span>

<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">device_info_service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">device_info_service</span><span class="p">();</span>
<span class="w">  </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">vendor_source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x02</span><span class="p">;</span><span class="w"> </span><span class="c1">// USB</span>
<span class="w">  </span><span class="n">device_info_service</span><span class="p">.</span><span class="n">set_pnp_id</span><span class="p">(</span><span class="n">vendor_source</span><span class="p">,</span><span class="w"> </span><span class="n">vid</span><span class="p">,</span><span class="w"> </span><span class="n">pid</span><span class="p">,</span><span class="w"> </span><span class="n">product_version</span><span class="p">);</span>
<span class="w">  </span><span class="n">device_info_service</span><span class="p">.</span><span class="n">set_manufacturer_name</span><span class="p">(</span><span class="n">manufacturer_name</span><span class="p">);</span>
<span class="w">  </span><span class="n">device_info_service</span><span class="p">.</span><span class="n">set_model_number</span><span class="p">(</span><span class="n">model_number</span><span class="p">);</span>
<span class="w">  </span><span class="n">device_info_service</span><span class="p">.</span><span class="n">set_serial_number</span><span class="p">(</span><span class="n">serial_number</span><span class="p">);</span>
<span class="w">  </span><span class="n">device_info_service</span><span class="p">.</span><span class="n">set_software_version</span><span class="p">(</span><span class="n">software_version</span><span class="p">);</span>
<span class="w">  </span><span class="n">device_info_service</span><span class="p">.</span><span class="n">set_firmware_version</span><span class="p">(</span><span class="n">firmware_version</span><span class="p">);</span>
<span class="w">  </span><span class="n">device_info_service</span><span class="p">.</span><span class="n">set_hardware_version</span><span class="p">(</span><span class="n">hardware_version</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// NOTE: iOS does not seem to show ext advertisements in their bluetooth</span>
<span class="w">  </span><span class="c1">// settings menu (even if you turn on legacy advertising)</span>

<span class="w">  </span><span class="c1">// set the advertisement data</span>
<span class="w">  </span><span class="n">espp</span><span class="o">::</span><span class="n">BleGattServer</span><span class="o">::</span><span class="n">AdvertisedData</span><span class="w"> </span><span class="n">adv_data</span><span class="p">;</span>
<span class="w">  </span><span class="c1">// uint8_t flags = BLE_HS_ADV_F_DISC_LTD;</span>
<span class="w">  </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BLE_HS_ADV_F_DISC_GEN</span><span class="p">;</span>
<span class="w">  </span><span class="n">adv_data</span><span class="p">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">flags</span><span class="p">);</span>
<span class="w">  </span><span class="n">adv_data</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="n">advertised_name</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// adv_data.setAppearance((uint16_t)espp::BleAppearance::GAMEPAD);</span>
<span class="w">  </span><span class="n">adv_data</span><span class="p">.</span><span class="n">setPartialServices16</span><span class="p">({</span><span class="n">hid_service</span><span class="p">.</span><span class="n">uuid</span><span class="p">()});</span>
<span class="w">  </span><span class="c1">// adv_data.addTxPower();</span>
<span class="w">  </span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">set_advertisement_data</span><span class="p">(</span><span class="n">adv_data</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// set scan response data to include the name</span>
<span class="w">  </span><span class="n">espp</span><span class="o">::</span><span class="n">BleGattServer</span><span class="o">::</span><span class="n">AdvertisedData</span><span class="w"> </span><span class="n">scan_response_data</span><span class="p">;</span>
<span class="w">  </span><span class="n">scan_response_data</span><span class="p">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">flags</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// Ensure the name is set correctly in the scan response</span>
<span class="w">  </span><span class="c1">// This is critical for proper device identification during scanning</span>
<span class="w">  </span><span class="n">scan_response_data</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="n">device_name</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// Add appearance to scan response for consistency</span>
<span class="w">  </span><span class="n">scan_response_data</span><span class="p">.</span><span class="n">setAppearance</span><span class="p">((</span><span class="kt">uint16_t</span><span class="p">)</span><span class="n">espp</span><span class="o">::</span><span class="n">BleAppearance</span><span class="o">::</span><span class="n">GAMEPAD</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// Add partial service list to scan response</span>
<span class="w">  </span><span class="n">scan_response_data</span><span class="p">.</span><span class="n">setPartialServices16</span><span class="p">({</span><span class="n">hid_service</span><span class="p">.</span><span class="n">uuid</span><span class="p">()});</span>
<span class="w">  </span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">set_scan_response_data</span><span class="p">(</span><span class="n">scan_response_data</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// now lets start advertising</span>
<span class="w">  </span><span class="n">espp</span><span class="o">::</span><span class="n">BleGattServer</span><span class="o">::</span><span class="n">AdvertisingParameters</span><span class="w"> </span><span class="n">adv_params</span><span class="p">;</span>
<span class="w">  </span><span class="n">adv_params</span><span class="p">.</span><span class="n">duration_ms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// never stop</span>
<span class="w">  </span><span class="c1">// Ensure scan response is enabled</span>
<span class="w">  </span><span class="n">adv_params</span><span class="p">.</span><span class="n">scan_response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">  </span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">start_advertising</span><span class="p">(</span><span class="n">adv_params</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// now lets update the battery level and send an input report every second</span>
<span class="w">  </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">battery_level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99</span><span class="p">;</span>
<span class="w">  </span><span class="c1">// change the gamepad inputs every second</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">button_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">was_connected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">steady_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// if we are now connected + bonded, but were not, then get the services</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">is_connected</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">was_connected</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">connected_device_infos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">get_connected_device_infos</span><span class="p">();</span>
<span class="w">      </span><span class="c1">// check to make sure the first connection has bonded at least.</span>
<span class="w">      </span><span class="c1">//</span>
<span class="w">      </span><span class="c1">// NOTE: if we are not bonded, then the name that will be read out will be</span>
<span class="w">      </span><span class="c1">// generic, such as &quot;iPhone&quot;. If we are bonded, then the name will be the</span>
<span class="w">      </span><span class="c1">// actual device name, such as &quot;iPhone 14 Plus William&quot;.</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">first_device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connected_device_infos</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">first_device</span><span class="p">.</span><span class="n">isBonded</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// if it was, mark connected and print all the device infos</span>
<span class="w">        </span><span class="n">was_connected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Connected devices: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">connected_device_infos</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">info</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">connected_device_infos</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">rssi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">get_connected_device_rssi</span><span class="p">(</span><span class="n">info</span><span class="p">);</span>
<span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">get_connected_device_name</span><span class="p">(</span><span class="n">info</span><span class="p">);</span>
<span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">mfg_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">get_connected_device_manufacturer_name</span><span class="p">(</span><span class="n">info</span><span class="p">);</span>
<span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">mn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">get_connected_device_model_number</span><span class="p">(</span><span class="n">info</span><span class="p">);</span>
<span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">pnp_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">get_connected_device_pnp_id</span><span class="p">(</span><span class="n">info</span><span class="p">);</span>
<span class="w">          </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;            RSSI:  {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">rssi</span><span class="p">);</span>
<span class="w">          </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;            Name:  {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
<span class="w">          </span><span class="c1">// NOTE: these are optionals, so they may not be set</span>
<span class="w">          </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;            Mfg:   {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mfg_name</span><span class="p">);</span>
<span class="w">          </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;            Model: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mn</span><span class="p">);</span>
<span class="w">          </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;            PnP:   {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pnp_id</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// print the bonded devices as well</span>
<span class="w">        </span><span class="n">paired_device_addresses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">get_paired_devices</span><span class="p">();</span>
<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Paired devices: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">paired_device_addresses</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">addr</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">paired_device_addresses</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;          Addr:  {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">.</span><span class="n">toString</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">is_connected</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">was_connected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">ble_gatt_server</span><span class="p">.</span><span class="n">is_connected</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// sleep</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_until</span><span class="p">(</span><span class="n">start</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span><span class="p">);</span>
<span class="w">      </span><span class="k">continue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// reset the input report</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// update the battery level</span>
<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Setting battery level: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">battery_level</span><span class="p">);</span>
<span class="w">    </span><span class="n">battery_service</span><span class="p">.</span><span class="n">set_battery_level</span><span class="p">(</span><span class="n">battery_level</span><span class="p">);</span>
<span class="cp">#if CONFIG_EXAMPLE_AS_XBOX</span>
<span class="w">    </span><span class="n">battery_input_report</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
<span class="w">    </span><span class="n">battery_input_report</span><span class="p">.</span><span class="n">set_rechargeable</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<span class="w">    </span><span class="n">battery_input_report</span><span class="p">.</span><span class="n">set_charging</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
<span class="w">    </span><span class="n">battery_input_report</span><span class="p">.</span><span class="n">set_battery_level</span><span class="p">(</span><span class="n">battery_level</span><span class="p">);</span>
<span class="w">    </span><span class="n">battery_report</span><span class="o">-&gt;</span><span class="n">notify</span><span class="p">(</span><span class="n">battery_input_report</span><span class="p">.</span><span class="n">get_report</span><span class="p">());</span>
<span class="cp">#elif CONFIG_EXAMPLE_AS_SWITCH_PRO</span>
<span class="w">    </span><span class="c1">// switch pro doesn&#39;t have a battery input report</span>
<span class="cp">#elif CONFIG_EXAMPLE_AS_PLAYSTATION_DUALSENSE_BLE</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">set_battery_level</span><span class="p">(</span><span class="n">battery_level</span><span class="p">);</span>
<span class="cp">#elif CONFIG_EXAMPLE_AS_PLAYSTATION_DUALSHOCK4_BLE</span>
<span class="w">    </span><span class="c1">// PS4 battery level is 0-10, map from 0-100</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">set_battery_level</span><span class="p">(</span><span class="n">battery_level</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">set_battery_charging</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
<span class="cp">#endif </span><span class="c1">// CONFIG_EXAMPLE_AS_XBOX</span>
<span class="w">    </span><span class="n">battery_level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">battery_level</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// update the report counter (if any)</span>
<span class="cp">#if CONFIG_EXAMPLE_AS_XBOX</span>
<span class="w">    </span><span class="c1">// xbox doesn&#39;t have a report counter</span>
<span class="cp">#elif CONFIG_EXAMPLE_AS_SWITCH_PRO</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">increment_counter</span><span class="p">();</span>
<span class="cp">#elif CONFIG_EXAMPLE_AS_PLAYSTATION_DUALSENSE_BLE</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">increment_timestamp</span><span class="p">();</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">increment_counter</span><span class="p">();</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">increment_coarse_timestamp</span><span class="p">();</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">increment_fine_timestamps</span><span class="p">();</span>
<span class="cp">#elif CONFIG_EXAMPLE_AS_PLAYSTATION_DUALSHOCK4_BLE</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">ps4_timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">ps4_counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">set_timestamp</span><span class="p">(</span><span class="n">ps4_timestamp</span><span class="o">++</span><span class="p">);</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">set_counter</span><span class="p">(</span><span class="n">ps4_counter</span><span class="o">++</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ps4_counter</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">64</span><span class="p">)</span>
<span class="w">      </span><span class="n">ps4_counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// counter is 6 bits</span>
<span class="cp">#endif</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">hat_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">max_hat_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// cycle through the possible d-pad states</span>
<span class="w">    </span><span class="n">GamepadInput</span><span class="o">::</span><span class="n">Hat</span><span class="w"> </span><span class="n">hat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">GamepadInput</span><span class="o">::</span><span class="n">Hat</span><span class="p">)(</span><span class="n">hat_value</span><span class="p">);</span>
<span class="w">    </span><span class="n">hat_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">hat_value</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">max_hat_value</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// use the button index to set the position of the right joystick</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">button_index</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">num_buttons</span><span class="p">;</span>

<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">set_hat</span><span class="p">(</span><span class="n">hat</span><span class="p">);</span>
<span class="cp">#if CONFIG_EXAMPLE_AS_PLAYSTATION_DUALSHOCK4_BLE</span>
<span class="w">    </span><span class="c1">// PS4 has specific button setters and different joystick/trigger ranges</span>
<span class="w">    </span><span class="c1">// Set a button based on button_index (cycle through face buttons)</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">set_button_cross</span><span class="p">(</span><span class="n">button_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">set_button_circle</span><span class="p">(</span><span class="n">button_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">set_button_square</span><span class="p">(</span><span class="n">button_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">set_button_triangle</span><span class="p">(</span><span class="n">button_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// PS4 joystick range is 0-255 with 128 as center</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">set_right_joystick</span><span class="p">(</span><span class="mi">128</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">127</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">127</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">));</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">set_left_joystick</span><span class="p">(</span><span class="mi">128</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">127</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">127</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">));</span>
<span class="w">    </span><span class="c1">// PS4 trigger range is 0-255</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">set_r2_trigger</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">255</span><span class="p">);</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">set_l2_trigger</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">255</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">set_button</span><span class="p">(</span><span class="n">button_index</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// joystick inputs are in the range [-1, 1] float</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">set_right_joystick</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">));</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">set_left_joystick</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">));</span>
<span class="w">    </span><span class="c1">// trigger inputs are in the range [0, 1] float</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">set_right_trigger</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)));</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">set_left_trigger</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)));</span>
<span class="cp">#endif</span>

<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Setting left joystick: ({:.1f}, {:.1f})&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">));</span>
<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Setting right joystick: ({:.1f}, {:.1f})&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">));</span>
<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Setting brake: {:.1f}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)));</span>
<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Setting accelerator: {:.1f}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)));</span>
<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Setting hat: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">hat</span><span class="p">);</span>
<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Setting button: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">button_index</span><span class="p">);</span>

<span class="cp">#if CONFIG_EXAMPLE_AS_XBOX</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">consumer_record</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">set_consumer_record</span><span class="p">(</span><span class="n">consumer_record</span><span class="p">);</span>
<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Setting consumer record: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">consumer_record</span><span class="p">);</span>
<span class="w">    </span><span class="n">consumer_record</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">consumer_record</span><span class="p">;</span>
<span class="cp">#endif </span><span class="c1">// CONFIG_EXAMPLE_AS_XBOX</span>

<span class="w">    </span><span class="n">button_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">button_index</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">num_buttons</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// send an input report</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">report</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">get_report</span><span class="p">();</span>

<span class="cp">#if CONFIG_EXAMPLE_AS_PLAYSTATION_DUALSENSE_BLE</span>
<span class="w">    </span><span class="c1">// calculate and set the CRC32 at the end of the report</span>
<span class="w">    </span><span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">ps_input_crc32_seed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xA1</span><span class="p">;</span>
<span class="w">    </span><span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">ps_output_crc32_seed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xA2</span><span class="p">;</span>
<span class="w">    </span><span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">ps_feature_crc32_seed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xA3</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// our CRC has to include the seed and the report_id, so make a new array</span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">report_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_report_id</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">seed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ps_input_crc32_seed</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">crc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">;</span>
<span class="w">    </span><span class="n">crc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_crc32_le</span><span class="p">(</span><span class="o">~</span><span class="n">crc</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">seed</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">crc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_crc32_le</span><span class="p">(</span><span class="n">crc</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">report_id</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">crc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_crc32_le</span><span class="p">(</span><span class="n">crc</span><span class="p">,</span><span class="w"> </span><span class="n">report</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">report</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<span class="w">    </span><span class="n">report</span><span class="p">[</span><span class="n">report</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">crc</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">;</span>
<span class="w">    </span><span class="n">report</span><span class="p">[</span><span class="n">report</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">crc</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">;</span>
<span class="w">    </span><span class="n">report</span><span class="p">[</span><span class="n">report</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">crc</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">;</span>
<span class="w">    </span><span class="n">report</span><span class="p">[</span><span class="n">report</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">crc</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">24</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">;</span>
<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Setting CRC32: 0x{:08x}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">crc</span><span class="p">);</span>
<span class="cp">#elif CONFIG_EXAMPLE_AS_PLAYSTATION_DUALSHOCK4_BLE</span>
<span class="w">    </span><span class="c1">// PS4 DualShock 4 doesn&#39;t use CRC32 in BLE mode (only in USB mode)</span>
<span class="cp">#endif </span><span class="c1">// CONFIG_EXAMPLE_AS_PLAYSTATION_DUALSENSE_BLE</span>

<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Set input report {} to {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">gamepad_input_report</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="n">gamepad_input_report</span><span class="p">);</span>
<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Sending report data ({}): {::#02x}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">report</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="n">report</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Get the stored pointer (we could use the one above, but this is just to</span>
<span class="w">    </span><span class="c1">// show how to get it)</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">report_char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hid_service</span><span class="p">.</span><span class="n">input_report</span><span class="p">(</span><span class="n">input_report_id</span><span class="p">);</span>
<span class="w">    </span><span class="n">report_char</span><span class="o">-&gt;</span><span class="n">notify</span><span class="p">(</span><span class="n">report</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Could also just do:</span>
<span class="w">    </span><span class="c1">// input_report-&gt;notify(report);</span>

<span class="w">    </span><span class="c1">// sleep</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_until</span><span class="p">(</span><span class="n">start</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">500</span><span class="n">ms</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
</section>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-public-functions">Public Functions</p>
<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService10HidServiceEN4espp6Logger9VerbosityE">
<span id="_CPPv3N4espp10HidService10HidServiceEN4espp6Logger9VerbosityE"></span><span id="_CPPv2N4espp10HidService10HidServiceEN4espp6Logger9VerbosityE"></span><span id="espp::HidService::HidService__espp::Logger::Verbosity"></span><span class="target" id="classespp_1_1HidService_1ae5f01a11f165a66496e7eafcc3e438a1"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="k"><span class="pre">explicit</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">HidService</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">espp</span></span><span class="p"><span class="pre">::</span></span><a class="reference internal" href="../logger.html#_CPPv4N4espp6LoggerE" title="espp::Logger"><span class="n"><span class="pre">Logger</span></span></a><span class="p"><span class="pre">::</span></span><a class="reference internal" href="../logger.html#_CPPv4N4espp6Logger9VerbosityE" title="espp::Logger::Verbosity"><span class="n"><span class="pre">Verbosity</span></span></a><span class="w"> </span><span class="n sig-param"><span class="pre">log_level</span></span><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="n"><span class="pre">espp</span></span><span class="p"><span class="pre">::</span></span><a class="reference internal" href="../logger.html#_CPPv4N4espp6LoggerE" title="espp::Logger"><span class="n"><span class="pre">Logger</span></span></a><span class="p"><span class="pre">::</span></span><a class="reference internal" href="../logger.html#_CPPv4N4espp6Logger9VerbosityE" title="espp::Logger::Verbosity"><span class="n"><span class="pre">Verbosity</span></span></a><span class="p"><span class="pre">::</span></span><a class="reference internal" href="../logger.html#_CPPv4N4espp6Logger9Verbosity4WARNE" title="espp::Logger::Verbosity::WARN"><span class="n"><span class="pre">WARN</span></span></a><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidService10HidServiceEN4espp6Logger9VerbosityE" title="Permalink to this definition"></a><br /></dt>
<dd><p>Constructor. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>log_level</strong> – The verbosity of the logger </p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService10HidServiceEP12NimBLEServerN4espp6Logger9VerbosityE">
<span id="_CPPv3N4espp10HidService10HidServiceEP12NimBLEServerN4espp6Logger9VerbosityE"></span><span id="_CPPv2N4espp10HidService10HidServiceEP12NimBLEServerN4espp6Logger9VerbosityE"></span><span id="espp::HidService::HidService__NimBLEServerP.espp::Logger::Verbosity"></span><span class="target" id="classespp_1_1HidService_1a23f2629d7fb8566272c5cac3bcf71943"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="k"><span class="pre">explicit</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">HidService</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">NimBLEServer</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">server</span></span>, <span class="n"><span class="pre">espp</span></span><span class="p"><span class="pre">::</span></span><a class="reference internal" href="../logger.html#_CPPv4N4espp6LoggerE" title="espp::Logger"><span class="n"><span class="pre">Logger</span></span></a><span class="p"><span class="pre">::</span></span><a class="reference internal" href="../logger.html#_CPPv4N4espp6Logger9VerbosityE" title="espp::Logger::Verbosity"><span class="n"><span class="pre">Verbosity</span></span></a><span class="w"> </span><span class="n sig-param"><span class="pre">log_level</span></span><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="n"><span class="pre">espp</span></span><span class="p"><span class="pre">::</span></span><a class="reference internal" href="../logger.html#_CPPv4N4espp6LoggerE" title="espp::Logger"><span class="n"><span class="pre">Logger</span></span></a><span class="p"><span class="pre">::</span></span><a class="reference internal" href="../logger.html#_CPPv4N4espp6Logger9VerbosityE" title="espp::Logger::Verbosity"><span class="n"><span class="pre">Verbosity</span></span></a><span class="p"><span class="pre">::</span></span><a class="reference internal" href="../logger.html#_CPPv4N4espp6Logger9Verbosity4WARNE" title="espp::Logger::Verbosity::WARN"><span class="n"><span class="pre">WARN</span></span></a><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidService10HidServiceEP12NimBLEServerN4espp6Logger9VerbosityE" title="Permalink to this definition"></a><br /></dt>
<dd><p>Constructor. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>server</strong> – The BLE server to use for the HID service. </p></li>
<li><p><strong>log_level</strong> – The verbosity of the logger </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidServiceD0Ev">
<span id="_CPPv3N4espp10HidServiceD0Ev"></span><span id="_CPPv2N4espp10HidServiceD0Ev"></span><span id="espp::HidService::~HidService"></span><span class="target" id="classespp_1_1HidService_1a348c01443f8902a76abb91aee29553ae"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">~HidService</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidServiceD0Ev" title="Permalink to this definition"></a><br /></dt>
<dd><p>Destructor. </p>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService4initEP12NimBLEServer">
<span id="_CPPv3N4espp10HidService4initEP12NimBLEServer"></span><span id="_CPPv2N4espp10HidService4initEP12NimBLEServer"></span><span id="espp::HidService::init__NimBLEServerP"></span><span class="target" id="classespp_1_1HidService_1a3592aa07f1e953a74e910a1166aff9b6"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">init</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">NimBLEServer</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">server</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidService4initEP12NimBLEServer" title="Permalink to this definition"></a><br /></dt>
<dd><p>Initialize the HID service. </p>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService6deinitEv">
<span id="_CPPv3N4espp10HidService6deinitEv"></span><span id="_CPPv2N4espp10HidService6deinitEv"></span><span id="espp::HidService::deinit"></span><span class="target" id="classespp_1_1HidService_1af98597a46ab548d60d9af33cc39be064"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">deinit</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidService6deinitEv" title="Permalink to this definition"></a><br /></dt>
<dd><p>Deinitialize the HID service. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This should only be called after NimBLEDevice::deinit(true) has been called, since that will free the memory used by the service. </p>
</div>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService5startEv">
<span id="_CPPv3N4espp10HidService5startEv"></span><span id="_CPPv2N4espp10HidService5startEv"></span><span id="espp::HidService::start"></span><span class="target" id="classespp_1_1HidService_1ab693ddb85c764d9963aaa4783b207cbc"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">start</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidService5startEv" title="Permalink to this definition"></a><br /></dt>
<dd><p>Start the HID service. </p>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService7serviceEv">
<span id="_CPPv3N4espp10HidService7serviceEv"></span><span id="_CPPv2N4espp10HidService7serviceEv"></span><span id="espp::HidService::service"></span><span class="target" id="classespp_1_1HidService_1a0d82c1f027ee62231129bb18c1504cb8"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="n"><span class="pre">NimBLEService</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">service</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidService7serviceEv" title="Permalink to this definition"></a><br /></dt>
<dd><p>Get the HID service. </p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The HID service. </p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService4uuidEv">
<span id="_CPPv3N4espp10HidService4uuidEv"></span><span id="_CPPv2N4espp10HidService4uuidEv"></span><span id="espp::HidService::uuid"></span><span class="target" id="classespp_1_1HidService_1aad552eda8c16d5ee551192e9fe2eaf84"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="n"><span class="pre">NimBLEUUID</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">uuid</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidService4uuidEv" title="Permalink to this definition"></a><br /></dt>
<dd><p>Get the UUID of the HID service. </p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The UUID of the HID service. </p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService14set_report_mapERKNSt6vectorI7uint8_tEE">
<span id="_CPPv3N4espp10HidService14set_report_mapERKNSt6vectorI7uint8_tEE"></span><span id="_CPPv2N4espp10HidService14set_report_mapERKNSt6vectorI7uint8_tEE"></span><span id="espp::HidService::set_report_map__std::vector:uint8_t:CR"></span><span class="target" id="classespp_1_1HidService_1ae99f9fb6858d59ddeda6bb650b685f7b"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">set_report_map</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">std</span></span><span class="p"><span class="pre">::</span></span><span class="n"><span class="pre">vector</span></span><span class="p"><span class="pre">&lt;</span></span><span class="n"><span class="pre">uint8_t</span></span><span class="p"><span class="pre">&gt;</span></span><span class="w"> </span><span class="p"><span class="pre">&amp;</span></span><span class="n sig-param"><span class="pre">report_map</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidService14set_report_mapERKNSt6vectorI7uint8_tEE" title="Permalink to this definition"></a><br /></dt>
<dd><p>Set the report map for the HID service. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>report_map</strong> – The report map as a vector of bytes. </p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService14set_report_mapENSt11string_viewE">
<span id="_CPPv3N4espp10HidService14set_report_mapENSt11string_viewE"></span><span id="_CPPv2N4espp10HidService14set_report_mapENSt11string_viewE"></span><span id="espp::HidService::set_report_map__std::string_view"></span><span class="target" id="classespp_1_1HidService_1a2b2d9e74ba57613ec74c454ff9004a6f"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">set_report_map</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">std</span></span><span class="p"><span class="pre">::</span></span><span class="n"><span class="pre">string_view</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">report_map</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidService14set_report_mapENSt11string_viewE" title="Permalink to this definition"></a><br /></dt>
<dd><p>Set the report map for the HID service. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>report_map</strong> – The report map as a string view. </p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService14set_report_mapEPK7uint8_t6size_t">
<span id="_CPPv3N4espp10HidService14set_report_mapEPK7uint8_t6size_t"></span><span id="_CPPv2N4espp10HidService14set_report_mapEPK7uint8_t6size_t"></span><span id="espp::HidService::set_report_map__uint8_tCP.s"></span><span class="target" id="classespp_1_1HidService_1a41a8b425465acae2d01dbdd1e3060643"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">set_report_map</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">report_map</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">report_map_len</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidService14set_report_mapEPK7uint8_t6size_t" title="Permalink to this definition"></a><br /></dt>
<dd><p>Set the report map for the HID service. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The report map is a descriptor that describes the format of the HID reports. It is used to tell the host how to interpret the reports that are sent by the HID device. </p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>report_map</strong> – The report map bytes </p></li>
<li><p><strong>report_map_len</strong> – The length of the report map. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService8set_infoE7uint8_t7uint8_t">
<span id="_CPPv3N4espp10HidService8set_infoE7uint8_t7uint8_t"></span><span id="_CPPv2N4espp10HidService8set_infoE7uint8_t7uint8_t"></span><span id="espp::HidService::set_info__uint8_t.uint8_t"></span><span class="target" id="classespp_1_1HidService_1aab71819a32f4ffa674eb0725450ded85"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">set_info</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">country</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">flags</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidService8set_infoE7uint8_t7uint8_t" title="Permalink to this definition"></a><br /></dt>
<dd><p>Set the HID information for the HID service. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>country</strong> – The country code. </p></li>
<li><p><strong>flags</strong> – The HID information flags. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService11get_controlEv">
<span id="_CPPv3N4espp10HidService11get_controlEv"></span><span id="_CPPv2N4espp10HidService11get_controlEv"></span><span id="espp::HidService::get_control"></span><span class="target" id="classespp_1_1HidService_1ae6b9175436d3e26d36d3c0e6a95d32e6"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="n"><span class="pre">NimBLECharacteristic</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">get_control</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidService11get_controlEv" title="Permalink to this definition"></a><br /></dt>
<dd><p>Get the control characteristic for the HID service. </p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The control characteristic. </p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService17get_protocol_modeEv">
<span id="_CPPv3N4espp10HidService17get_protocol_modeEv"></span><span id="_CPPv2N4espp10HidService17get_protocol_modeEv"></span><span id="espp::HidService::get_protocol_mode"></span><span class="target" id="classespp_1_1HidService_1afebc408c8475229880e3032634501116"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="n"><span class="pre">NimBLECharacteristic</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">get_protocol_mode</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidService17get_protocol_modeEv" title="Permalink to this definition"></a><br /></dt>
<dd><p>Get the protocol mode characteristic for the HID service. </p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The protocol mode characteristic. </p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService12input_reportE7uint8_t">
<span id="_CPPv3N4espp10HidService12input_reportE7uint8_t"></span><span id="_CPPv2N4espp10HidService12input_reportE7uint8_t"></span><span id="espp::HidService::input_report__uint8_t"></span><span class="target" id="classespp_1_1HidService_1ac490b2424e7f09308f136b2f35502b26"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="n"><span class="pre">NimBLECharacteristic</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">input_report</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">report_id</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidService12input_reportE7uint8_t" title="Permalink to this definition"></a><br /></dt>
<dd><p>Create an input report characteristic. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>report_id</strong> – The report ID. This should be the same as the report ID in the report descriptor for the input object that is related to the characteristic. </p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The input report characteristic. </p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService19remove_input_reportE7uint8_t">
<span id="_CPPv3N4espp10HidService19remove_input_reportE7uint8_t"></span><span id="_CPPv2N4espp10HidService19remove_input_reportE7uint8_t"></span><span id="espp::HidService::remove_input_report__uint8_t"></span><span class="target" id="classespp_1_1HidService_1a4ada91dab206eae30a6dd844df16e38a"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">remove_input_report</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">report_id</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidService19remove_input_reportE7uint8_t" title="Permalink to this definition"></a><br /></dt>
<dd><p>Remove an input report characteristic. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This will delete the characteristic, and remove it from the list. Any stored pointers to the characteristic will be invalid after this call. </p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>report_id</strong> – The report ID of the input report characteristic to remove. </p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService13output_reportE7uint8_t">
<span id="_CPPv3N4espp10HidService13output_reportE7uint8_t"></span><span id="_CPPv2N4espp10HidService13output_reportE7uint8_t"></span><span id="espp::HidService::output_report__uint8_t"></span><span class="target" id="classespp_1_1HidService_1a17a11ebe7194c08742480e026b937faf"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="n"><span class="pre">NimBLECharacteristic</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">output_report</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">report_id</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidService13output_reportE7uint8_t" title="Permalink to this definition"></a><br /></dt>
<dd><p>Create an output report characteristic. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>report_id</strong> – The report ID. This should be the same as the report ID in the report descriptor for the output object that is related to the characteristic. </p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The output report characteristic. </p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService20remove_output_reportE7uint8_t">
<span id="_CPPv3N4espp10HidService20remove_output_reportE7uint8_t"></span><span id="_CPPv2N4espp10HidService20remove_output_reportE7uint8_t"></span><span id="espp::HidService::remove_output_report__uint8_t"></span><span class="target" id="classespp_1_1HidService_1aa5be27a87a5a1d54f56da046783963bc"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">remove_output_report</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">report_id</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidService20remove_output_reportE7uint8_t" title="Permalink to this definition"></a><br /></dt>
<dd><p>Remove an output report characteristic. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This will delete the characteristic, and remove it from the list. Any stored pointers to the characteristic will be invalid after this call. </p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>report_id</strong> – The report ID of the output report characteristic to remove. </p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService14feature_reportE7uint8_t">
<span id="_CPPv3N4espp10HidService14feature_reportE7uint8_t"></span><span id="_CPPv2N4espp10HidService14feature_reportE7uint8_t"></span><span id="espp::HidService::feature_report__uint8_t"></span><span class="target" id="classespp_1_1HidService_1afa5ed60dad00fe6981f99322f8eaea00"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="n"><span class="pre">NimBLECharacteristic</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">feature_report</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">report_id</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidService14feature_reportE7uint8_t" title="Permalink to this definition"></a><br /></dt>
<dd><p>Create a feature report characteristic. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>report_id</strong> – The report ID. This should be the same as the report ID in the report descriptor for the feature object that is related to the characteristic. </p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The feature report characteristic. </p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService21remove_feature_reportE7uint8_t">
<span id="_CPPv3N4espp10HidService21remove_feature_reportE7uint8_t"></span><span id="_CPPv2N4espp10HidService21remove_feature_reportE7uint8_t"></span><span id="espp::HidService::remove_feature_report__uint8_t"></span><span class="target" id="classespp_1_1HidService_1a81b5d96a3860bd741a565af46b29aa87"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">remove_feature_report</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">report_id</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidService21remove_feature_reportE7uint8_t" title="Permalink to this definition"></a><br /></dt>
<dd><p>Remove a feature report characteristic. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This will delete the characteristic, and remove it from the list. Any stored pointers to the characteristic will be invalid after this call. </p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>report_id</strong> – The report ID of the feature report characteristic to remove. </p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4NK4espp10HidService8get_nameEv">
<span id="_CPPv3NK4espp10HidService8get_nameEv"></span><span id="_CPPv2NK4espp10HidService8get_nameEv"></span><span id="espp::HidService::get_nameC"></span><span class="target" id="classespp_1_1BaseComponent_1ad3813fa0c9c026e217163c4e2fdfc4a2"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">std</span></span><span class="p"><span class="pre">::</span></span><span class="n"><span class="pre">string</span></span><span class="w"> </span><span class="p"><span class="pre">&amp;</span></span><span class="sig-name descname"><span class="n"><span class="pre">get_name</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><span class="w"> </span><span class="k"><span class="pre">const</span></span><a class="headerlink" href="#_CPPv4NK4espp10HidService8get_nameEv" title="Permalink to this definition"></a><br /></dt>
<dd><p>Get the name of the component </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is the tag of the logger </p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A const reference to the name of the component </p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService11set_log_tagERKNSt11string_viewE">
<span id="_CPPv3N4espp10HidService11set_log_tagERKNSt11string_viewE"></span><span id="_CPPv2N4espp10HidService11set_log_tagERKNSt11string_viewE"></span><span id="espp::HidService::set_log_tag__std::string_viewCR"></span><span class="target" id="classespp_1_1BaseComponent_1af83083445936081581ffbddd93634b90"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">set_log_tag</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">std</span></span><span class="p"><span class="pre">::</span></span><span class="n"><span class="pre">string_view</span></span><span class="w"> </span><span class="p"><span class="pre">&amp;</span></span><span class="n sig-param"><span class="pre">tag</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidService11set_log_tagERKNSt11string_viewE" title="Permalink to this definition"></a><br /></dt>
<dd><p>Set the tag for the logger </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>tag</strong> – The tag to use for the logger </p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4NK4espp10HidService13get_log_levelEv">
<span id="_CPPv3NK4espp10HidService13get_log_levelEv"></span><span id="_CPPv2NK4espp10HidService13get_log_levelEv"></span><span id="espp::HidService::get_log_levelC"></span><span class="target" id="classespp_1_1BaseComponent_1a54f34a70b117486a7055e4a6f1d4d7a8"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="n"><span class="pre">espp</span></span><span class="p"><span class="pre">::</span></span><a class="reference internal" href="../logger.html#_CPPv4N4espp6LoggerE" title="espp::Logger"><span class="n"><span class="pre">Logger</span></span></a><span class="p"><span class="pre">::</span></span><a class="reference internal" href="../logger.html#_CPPv4N4espp6Logger9VerbosityE" title="espp::Logger::Verbosity"><span class="n"><span class="pre">Verbosity</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">get_log_level</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><span class="w"> </span><span class="k"><span class="pre">const</span></span><a class="headerlink" href="#_CPPv4NK4espp10HidService13get_log_levelEv" title="Permalink to this definition"></a><br /></dt>
<dd><p>Get the log level for the logger <div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../logger.html#classespp_1_1Logger_1ac6c63313236b0ae6ff44f3f94a6f99cb"><span class="std std-ref">Logger::Verbosity</span></a></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../logger.html#classespp_1_1Logger_1aa8c260085619fd42e17b92c41a638741"><span class="std std-ref">Logger::set_verbosity</span></a></p>
</div>
</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The verbosity level of the logger </p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService13set_log_levelEN4espp6Logger9VerbosityE">
<span id="_CPPv3N4espp10HidService13set_log_levelEN4espp6Logger9VerbosityE"></span><span id="_CPPv2N4espp10HidService13set_log_levelEN4espp6Logger9VerbosityE"></span><span id="espp::HidService::set_log_level__espp::Logger::Verbosity"></span><span class="target" id="classespp_1_1BaseComponent_1a3159df4e466f93ebb6cca7e685d27243"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">set_log_level</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">espp</span></span><span class="p"><span class="pre">::</span></span><a class="reference internal" href="../logger.html#_CPPv4N4espp6LoggerE" title="espp::Logger"><span class="n"><span class="pre">Logger</span></span></a><span class="p"><span class="pre">::</span></span><a class="reference internal" href="../logger.html#_CPPv4N4espp6Logger9VerbosityE" title="espp::Logger::Verbosity"><span class="n"><span class="pre">Verbosity</span></span></a><span class="w"> </span><span class="n sig-param"><span class="pre">level</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidService13set_log_levelEN4espp6Logger9VerbosityE" title="Permalink to this definition"></a><br /></dt>
<dd><p>Set the log level for the logger <div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../logger.html#classespp_1_1Logger_1ac6c63313236b0ae6ff44f3f94a6f99cb"><span class="std std-ref">Logger::Verbosity</span></a></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../logger.html#classespp_1_1Logger_1aa8c260085619fd42e17b92c41a638741"><span class="std std-ref">Logger::set_verbosity</span></a></p>
</div>
</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>level</strong> – The verbosity level to use for the logger </p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService17set_log_verbosityEN4espp6Logger9VerbosityE">
<span id="_CPPv3N4espp10HidService17set_log_verbosityEN4espp6Logger9VerbosityE"></span><span id="_CPPv2N4espp10HidService17set_log_verbosityEN4espp6Logger9VerbosityE"></span><span id="espp::HidService::set_log_verbosity__espp::Logger::Verbosity"></span><span class="target" id="classespp_1_1BaseComponent_1abb459bcd55b41471e201475fbf1a1b1f"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">set_log_verbosity</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">espp</span></span><span class="p"><span class="pre">::</span></span><a class="reference internal" href="../logger.html#_CPPv4N4espp6LoggerE" title="espp::Logger"><span class="n"><span class="pre">Logger</span></span></a><span class="p"><span class="pre">::</span></span><a class="reference internal" href="../logger.html#_CPPv4N4espp6Logger9VerbosityE" title="espp::Logger::Verbosity"><span class="n"><span class="pre">Verbosity</span></span></a><span class="w"> </span><span class="n sig-param"><span class="pre">level</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidService17set_log_verbosityEN4espp6Logger9VerbosityE" title="Permalink to this definition"></a><br /></dt>
<dd><p>Set the log verbosity for the logger <div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../ws_s3_touch.html#classespp_1_1BaseComponent_1a3159df4e466f93ebb6cca7e685d27243"><span class="std std-ref">set_log_level</span></a></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../logger.html#classespp_1_1Logger_1ac6c63313236b0ae6ff44f3f94a6f99cb"><span class="std std-ref">Logger::Verbosity</span></a></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../logger.html#classespp_1_1Logger_1aa8c260085619fd42e17b92c41a638741"><span class="std std-ref">Logger::set_verbosity</span></a></p>
</div>
</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is a convenience method that calls set_log_level </p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>level</strong> – The verbosity level to use for the logger </p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4NK4espp10HidService17get_log_verbosityEv">
<span id="_CPPv3NK4espp10HidService17get_log_verbosityEv"></span><span id="_CPPv2NK4espp10HidService17get_log_verbosityEv"></span><span id="espp::HidService::get_log_verbosityC"></span><span class="target" id="classespp_1_1BaseComponent_1ac9cda1ea5d5321040ca13a827057ff79"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="n"><span class="pre">espp</span></span><span class="p"><span class="pre">::</span></span><a class="reference internal" href="../logger.html#_CPPv4N4espp6LoggerE" title="espp::Logger"><span class="n"><span class="pre">Logger</span></span></a><span class="p"><span class="pre">::</span></span><a class="reference internal" href="../logger.html#_CPPv4N4espp6Logger9VerbosityE" title="espp::Logger::Verbosity"><span class="n"><span class="pre">Verbosity</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">get_log_verbosity</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><span class="w"> </span><span class="k"><span class="pre">const</span></span><a class="headerlink" href="#_CPPv4NK4espp10HidService17get_log_verbosityEv" title="Permalink to this definition"></a><br /></dt>
<dd><p>Get the log verbosity for the logger <div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../ws_s3_touch.html#classespp_1_1BaseComponent_1a54f34a70b117486a7055e4a6f1d4d7a8"><span class="std std-ref">get_log_level</span></a></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../logger.html#classespp_1_1Logger_1ac6c63313236b0ae6ff44f3f94a6f99cb"><span class="std std-ref">Logger::Verbosity</span></a></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../logger.html#classespp_1_1Logger_1a6ed0028b750b3e4aae21d2ecb3670c55"><span class="std std-ref">Logger::get_verbosity</span></a></p>
</div>
</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is a convenience method that calls get_log_level </p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The verbosity level of the logger </p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService18set_log_rate_limitENSt6chrono8durationIfEE">
<span id="_CPPv3N4espp10HidService18set_log_rate_limitENSt6chrono8durationIfEE"></span><span id="_CPPv2N4espp10HidService18set_log_rate_limitENSt6chrono8durationIfEE"></span><span id="espp::HidService::set_log_rate_limit__std::chrono::duration:float:"></span><span class="target" id="classespp_1_1BaseComponent_1a8b95d7a8a87f22a989f3654a238774a0"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">set_log_rate_limit</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">std</span></span><span class="p"><span class="pre">::</span></span><span class="n"><span class="pre">chrono</span></span><span class="p"><span class="pre">::</span></span><span class="n"><span class="pre">duration</span></span><span class="p"><span class="pre">&lt;</span></span><span class="kt"><span class="pre">float</span></span><span class="p"><span class="pre">&gt;</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">rate_limit</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N4espp10HidService18set_log_rate_limitENSt6chrono8durationIfEE" title="Permalink to this definition"></a><br /></dt>
<dd><p>Set the rate limit for the logger <div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../logger.html#classespp_1_1Logger_1a9ce0c51e1bf43e63235c6ddf3280b15d"><span class="std std-ref">Logger::set_rate_limit</span></a></p>
</div>
</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only calls to the logger that have _rate_limit suffix will be rate limited </p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>rate_limit</strong> – The rate limit to use for the logger </p>
</dd>
</dl>
</dd></dl>

</div>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-public-static-attributes">Public Static Attributes</p>
<dl class="cpp var">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService12SERVICE_UUIDE">
<span id="_CPPv3N4espp10HidService12SERVICE_UUIDE"></span><span id="_CPPv2N4espp10HidService12SERVICE_UUIDE"></span><span id="espp::HidService::SERVICE_UUID__uint16_t"></span><span class="target" id="classespp_1_1HidService_1a439ccf3f159f867ea519e28c3a2afee3"></span><span class="k"><span class="pre">static</span></span><span class="w"> </span><span class="k"><span class="pre">constexpr</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">SERVICE_UUID</span></span></span><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="m"><span class="pre">0x1812</span></span><a class="headerlink" href="#_CPPv4N4espp10HidService12SERVICE_UUIDE" title="Permalink to this definition"></a><br /></dt>
<dd><p>HID Service UUID. </p>
</dd></dl>

<dl class="cpp var">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService20HID_INFORMATION_UUIDE">
<span id="_CPPv3N4espp10HidService20HID_INFORMATION_UUIDE"></span><span id="_CPPv2N4espp10HidService20HID_INFORMATION_UUIDE"></span><span id="espp::HidService::HID_INFORMATION_UUID__uint16_t"></span><span class="target" id="classespp_1_1HidService_1a66a51ad4a3a03360c09be3bbe0074a75"></span><span class="k"><span class="pre">static</span></span><span class="w"> </span><span class="k"><span class="pre">constexpr</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">HID_INFORMATION_UUID</span></span></span><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="m"><span class="pre">0x2a4a</span></span><a class="headerlink" href="#_CPPv4N4espp10HidService20HID_INFORMATION_UUIDE" title="Permalink to this definition"></a><br /></dt>
<dd><p>HID Information UUID. </p>
</dd></dl>

<dl class="cpp var">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService15REPORT_MAP_UUIDE">
<span id="_CPPv3N4espp10HidService15REPORT_MAP_UUIDE"></span><span id="_CPPv2N4espp10HidService15REPORT_MAP_UUIDE"></span><span id="espp::HidService::REPORT_MAP_UUID__uint16_t"></span><span class="target" id="classespp_1_1HidService_1a99daf6aa807c374b6fb859298d3390ae"></span><span class="k"><span class="pre">static</span></span><span class="w"> </span><span class="k"><span class="pre">constexpr</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">REPORT_MAP_UUID</span></span></span><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="m"><span class="pre">0x2a4b</span></span><a class="headerlink" href="#_CPPv4N4espp10HidService15REPORT_MAP_UUIDE" title="Permalink to this definition"></a><br /></dt>
<dd><p>Report Map UUID. </p>
</dd></dl>

<dl class="cpp var">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService22HID_CONTROL_POINT_UUIDE">
<span id="_CPPv3N4espp10HidService22HID_CONTROL_POINT_UUIDE"></span><span id="_CPPv2N4espp10HidService22HID_CONTROL_POINT_UUIDE"></span><span id="espp::HidService::HID_CONTROL_POINT_UUID__uint16_t"></span><span class="target" id="classespp_1_1HidService_1aac2ff804960ee83633219a6dfdfa2ba1"></span><span class="k"><span class="pre">static</span></span><span class="w"> </span><span class="k"><span class="pre">constexpr</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">HID_CONTROL_POINT_UUID</span></span></span><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="m"><span class="pre">0x2a4c</span></span><a class="headerlink" href="#_CPPv4N4espp10HidService22HID_CONTROL_POINT_UUIDE" title="Permalink to this definition"></a><br /></dt>
<dd><p>HID Control Point UUID. </p>
</dd></dl>

<dl class="cpp var">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService18PROTOCOL_MODE_UUIDE">
<span id="_CPPv3N4espp10HidService18PROTOCOL_MODE_UUIDE"></span><span id="_CPPv2N4espp10HidService18PROTOCOL_MODE_UUIDE"></span><span id="espp::HidService::PROTOCOL_MODE_UUID__uint16_t"></span><span class="target" id="classespp_1_1HidService_1a95dd1d973df3337622b42e123c091d23"></span><span class="k"><span class="pre">static</span></span><span class="w"> </span><span class="k"><span class="pre">constexpr</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">PROTOCOL_MODE_UUID</span></span></span><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="m"><span class="pre">0x2a4e</span></span><a class="headerlink" href="#_CPPv4N4espp10HidService18PROTOCOL_MODE_UUIDE" title="Permalink to this definition"></a><br /></dt>
<dd><p>Protocol Mode UUID. </p>
</dd></dl>

<dl class="cpp var">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService11REPORT_UUIDE">
<span id="_CPPv3N4espp10HidService11REPORT_UUIDE"></span><span id="_CPPv2N4espp10HidService11REPORT_UUIDE"></span><span id="espp::HidService::REPORT_UUID__uint16_t"></span><span class="target" id="classespp_1_1HidService_1a3e6c82d1bbad6b18ecfb41f1bda8d60d"></span><span class="k"><span class="pre">static</span></span><span class="w"> </span><span class="k"><span class="pre">constexpr</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">REPORT_UUID</span></span></span><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="m"><span class="pre">0x2a4d</span></span><a class="headerlink" href="#_CPPv4N4espp10HidService11REPORT_UUIDE" title="Permalink to this definition"></a><br /></dt>
<dd><p>Report UUID. </p>
</dd></dl>

<dl class="cpp var">
<dt class="sig sig-object cpp" id="_CPPv4N4espp10HidService22REPORT_DESCRIPTOR_UUIDE">
<span id="_CPPv3N4espp10HidService22REPORT_DESCRIPTOR_UUIDE"></span><span id="_CPPv2N4espp10HidService22REPORT_DESCRIPTOR_UUIDE"></span><span id="espp::HidService::REPORT_DESCRIPTOR_UUID__uint16_t"></span><span class="target" id="classespp_1_1HidService_1ae79cdb89b736762f1e004b0c32987cc1"></span><span class="k"><span class="pre">static</span></span><span class="w"> </span><span class="k"><span class="pre">constexpr</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">REPORT_DESCRIPTOR_UUID</span></span></span><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="m"><span class="pre">0x2908</span></span><a class="headerlink" href="#_CPPv4N4espp10HidService22REPORT_DESCRIPTOR_UUIDE" title="Permalink to this definition"></a><br /></dt>
<dd><p>Report Descriptor UUID. </p>
</dd></dl>

</div>
</dd></dl>

</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="gfps_service_example.html" class="btn btn-neutral float-left" title="Google Fast Pair Service (GFPS) Service Example" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="hid_service_example.html" class="btn btn-neutral float-right" title="BLE HID Service Example" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022 - 2026, William Emfinger.</p>
  </div>

  <ul class="footer">
        <li>
	    
            
            Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/espressif/sphinx_idf_theme">theme</a>  based on <a href="https://github.com/readthedocs/sphinx_rtd_theme">Read the Docs Sphinx Theme</a>.
         </li>

  </ul> 

</footer>
        </div>
      </div>
    </section>
  </div>

  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>